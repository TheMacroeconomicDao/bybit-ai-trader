# üîß –§–ò–ù–ê–õ–¨–ù–´–ô –ü–†–û–ú–ü–¢: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –õ–æ–∂–Ω—ã—Ö –°–∏–≥–Ω–∞–ª–æ–≤ - –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –†–µ—à–µ–Ω–∏–µ

**–í–µ—Ä—Å–∏—è:** 2.0 FINAL  
**–î–∞—Ç–∞:** 2025-01-XX  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û  
**–°—Ç–∞—Ç—É—Å:** –ì–û–¢–û–í–û –ö –í–ù–ï–î–†–ï–ù–ò–Æ

---

## üìã EXECUTIVE SUMMARY

### –ü—Ä–æ–±–ª–µ–º–∞
–ê–≤—Ç–æ–Ω–æ–º–Ω—ã–π –∞–≥–µ–Ω—Ç –≤—ã–¥–∞—ë—Ç –ª–æ–∂–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã –∏–∑-–∑–∞:
1. –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è HOLD —Å–∏–≥–Ω–∞–ª–æ–≤ —Å –Ω–∏–∑–∫–æ–π confidence
2. –ü—Ä–æ–≤–µ—Ä–∫–∏ volume —Ç–æ–ª—å–∫–æ –Ω–∞ 4h (–Ω–µ –Ω–∞ –∫–æ—Ä–æ—Ç–∫–∏—Ö TF –¥–ª—è —Å–∫–∞–ª—å–ø–∏–Ω–≥–∞)
3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏—è —É—á–µ—Ç–∞ MACD direction –Ω–∞ –∫–æ—Ä–æ—Ç–∫–∏—Ö TF
4. –ó–∞–≤—ã—à–µ–Ω–Ω–æ–π probability —Ñ–æ—Ä–º—É–ª—ã
5. –û—Ç—Å—É—Ç—Å—Ç–≤–∏—è penalties –¥–ª—è —Å–ª–∞–±—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤

### –†–µ—à–µ–Ω–∏–µ
**–ù–ï –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å–∏–≥–Ω–∞–ª—ã**, –∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Ö –æ—Ü–µ–Ω–∏–≤–∞—Ç—å —á–µ—Ä–µ–∑:
- ‚úÖ Penalties –≤ scoring (—Å–ª–∞–±—ã–µ —Å–∏–≥–Ω–∞–ª—ã –ø–æ–ª—É—á–∞—é—Ç –Ω–∏–∑–∫–∏–π score)
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é probability —Ñ–æ—Ä–º—É–ª—É (—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ 25-75%)
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—É—é –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é —á–µ—Ä–µ–∑ tier system
- ‚úÖ –í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ª—É—á—à–∏–µ –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö (–º–∏–Ω–∏–º—É–º 3.0/20, probability 25%+)
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω—É—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —Å—Ç–µ–π–±–ª/—Å—Ç–µ–π–±–ª –ø–∞—Ä

---

## üéØ –ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–´–ï –†–ï–®–ï–ù–ò–Ø

### –†–µ—à–µ–Ω–∏–µ #1: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π Score –¥–ª—è –ü–æ–∫–∞–∑–∞
```
–ú–∏–Ω–∏–º—É–º: 3.0/20 (–Ω–∏–∂–µ —É–∂–µ –Ω–µ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª–∞)
–õ–æ–≥–∏–∫–∞: –î–∞–∂–µ —Å–ª–∞–±—ã–µ —Å–∏–≥–Ω–∞–ª—ã –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ warnings
Best Practice: –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º warning, –Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å
```

### –†–µ—à–µ–Ω–∏–µ #2: –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è Probability
```
–ú–∏–Ω–∏–º—É–º: 25% (—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –º–∏–Ω–∏–º—É–º)
–õ–æ–≥–∏–∫–∞: –î–∞–∂–µ –ø–ª–æ—Ö–∏–µ setups –∏–º–µ—é—Ç 20-30% —à–∞–Ω—Å
Best Practice: –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å warning, –Ω–æ –Ω–µ —Å–∫—Ä—ã–≤–∞—Ç—å
```

### –†–µ—à–µ–Ω–∏–µ #3: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –°–∏–≥–Ω–∞–ª–æ–≤
```
–í—Å–µ–≥–¥–∞: –¢–æ–ø-3 LONG + –¢–æ–ø-3 SHORT
–õ–æ–≥–∏–∫–∞: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –≤–∏–¥–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –Ω–∞ —Ä—ã–Ω–∫–µ
Best Practice: –î–∞–∂–µ –µ—Å–ª–∏ –≤—Å–µ "high_risk" - –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å warnings
```

### –†–µ—à–µ–Ω–∏–µ #4: –°—Ç–µ–π–±–ª/–°—Ç–µ–π–±–ª –ü–∞—Ä—ã
```
–£–ª—É—á—à–∏—Ç—å: –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤ market_scanner.py
–õ–æ–≥–∏–∫–∞: –£–∂–µ –µ—Å—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è, –Ω–æ –Ω—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤–µ–∑–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è
Best Practice: –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –Ω–∞ —ç—Ç–∞–ø–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–µ –Ω–∞ —ç—Ç–∞–ø–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
```

---

## üîß –û–ü–¢–ò–ú–ê–õ–¨–ù–´–ï –ü–ê–†–ê–ú–ï–¢–†–´

### 1. SCORING PENALTIES

```python
PENALTY_CONFIG = {
    # Composite Signal Penalties
    "hold_signal_penalty": -2.0,              # HOLD ‚Üí -2.0
    "hold_low_confidence_penalty": -1.0,      # HOLD + confidence <0.5 ‚Üí -1.0
    "low_confidence_penalty": -1.5,            # confidence <0.4 ‚Üí -1.5
    
    # Volume Penalties (–¥–ª—è —Å–∫–∞–ª—å–ø–∏–Ω–≥–∞)
    "critical_low_volume": -2.0,              # volume <0.3 –Ω–∞ entry TF ‚Üí -2.0
    "low_volume_1m": -1.5,                    # volume <0.5 –Ω–∞ 1m ‚Üí -1.5
    "low_volume_5m": -1.0,                    # volume <0.5 –Ω–∞ 5m ‚Üí -1.0
    "low_volume_15m": -0.5,                   # volume <0.5 –Ω–∞ 15m ‚Üí -0.5
    
    # MACD Alignment Penalties
    "macd_contradiction_2tf": -1.5,          # 2+ TF –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—Ç ‚Üí -1.5
    "macd_contradiction_1tf": -0.5,           # 1 TF –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç ‚Üí -0.5
}
```

### 2. PROBABILITY FORMULA

```python
PROBABILITY_CONFIG = {
    "min_probability": 0.25,                  # –ú–∏–Ω–∏–º—É–º 25%
    "max_probability": 0.75,                  # –ú–∞–∫—Å–∏–º—É–º 75% (—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ!)
    "base_formula": "0.30 + (score - 5.0) * 0.03",  # Score 5.0=30%, 20.0=75%
    "confidence_as_multiplier": True,         # confidence = MULTIPLIER
    "hold_multiplier": 0.5,                   # HOLD ‚Üí *0.5
    "hold_low_conf_probability": 0.30,        # HOLD + conf<0.5 ‚Üí 30%
    "strong_signal_multiplier": 1.1,          # STRONG_BUY/SELL ‚Üí *1.1
}
```

### 3. DISPLAY THRESHOLDS

```python
DISPLAY_CONFIG = {
    "min_score_to_show": 3.0,                 # –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å score ‚â•3.0/20
    "min_probability_to_show": 0.25,          # –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å probability ‚â•25%
    "max_signals_per_direction": 3,            # –¢–æ–ø-3 LONG + —Ç–æ–ø-3 SHORT
    "always_show_best_available": True,       # –í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ª—É—á—à–∏–µ
}
```

### 4. STABLE/STABLE PAIRS FILTER

```python
STABLE_PAIRS_CONFIG = {
    "filter_at_scanning": True,                # –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
    "stablecoins": {
        'USDT', 'USDC', 'BUSD', 'DAI', 'TUSD', 
        'USDP', 'USDD', 'FRAX', 'LUSD', 'MIM', 'RLUSD'
    },
    "fiats": {'TRY', 'BRL', 'EUR', 'GBP', 'AUD', 'RUB'},
}
```

---

## üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –í –ö–û–î–ï

### –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #1: `_calculate_opportunity_score()` - –î–æ–±–∞–≤–∏—Ç—å Penalties –ü–ï–†–ï–î Scoring

**–§–∞–π–ª:** `mcp_server/market_scanner.py`  
**–§—É–Ω–∫—Ü–∏—è:** `_calculate_opportunity_score()` (—Å—Ç—Ä–æ–∫–∏ 541-840)

**–ò–ó–ú–ï–ù–ò–¢–¨ –Ω–∞—á–∞–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏ (–ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 573):**

```python
def _calculate_opportunity_score(self, analysis: Dict, ticker: Dict, btc_trend: str = "neutral", entry_plan: Dict = None) -> Dict[str, Any]:
    """
    20-POINT CONFLUENCE MATRIX —Å PENALTIES –¥–ª—è —Å–ª–∞–±—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
    
    –í–ê–ñ–ù–û: Penalties –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ü–ï–†–ï–î –æ—Å–Ω–æ–≤–Ω—ã–º scoring!
    """
    score = 0.0
    breakdown = {}
    penalties = []  # –ù–û–í–û–ï: —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã—Ö penalties
    warnings = []   # –ù–û–í–û–ï: —Å–ø–∏—Å–æ–∫ warnings
    
    composite = analysis.get('composite_signal', {})
    signal = composite.get('signal', 'HOLD')
    confidence = composite.get('confidence', 0.5)
    
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    # PENALTY PHASE: –ü—Ä–∏–º–µ–Ω—è–µ–º penalties –ü–ï–†–ï–î scoring
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    
    # PENALTY #1: Composite Signal HOLD
    if signal == 'HOLD':
        penalty = -2.0
        score += penalty
        penalties.append(f"HOLD signal: {penalty:.1f}")
        breakdown['hold_penalty'] = penalty
        warnings.append("‚ö†Ô∏è Composite signal is HOLD (uncertainty)")
        
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π penalty –µ—Å–ª–∏ confidence –Ω–∏–∑–∫–∞—è
        if confidence < 0.5:
            additional_penalty = -1.0
            score += additional_penalty
            penalties.append(f"HOLD + low confidence ({confidence:.2f}): {additional_penalty:.1f}")
            breakdown['hold_low_conf_penalty'] = additional_penalty
            warnings.append(f"‚ö†Ô∏è Very low confidence ({confidence:.2f})")
    
    # PENALTY #2: Low Confidence (–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç signal)
    if confidence < 0.4:
        penalty = -1.5
        score += penalty
        penalties.append(f"Very low confidence ({confidence:.2f}): {penalty:.1f}")
        breakdown['low_confidence_penalty'] = penalty
        warnings.append(f"üî¥ Critical: Confidence too low ({confidence:.2f} < 0.4)")
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–ø–æ—Å–ª–µ penalties, –Ω–æ –¥–æ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ scoring)
    is_long = signal in ['STRONG_BUY', 'BUY']
    is_short = signal in ['STRONG_SELL', 'SELL']
    
    if not is_long and not is_short:
        buy_signals = composite.get('buy_signals', 0)
        sell_signals = composite.get('sell_signals', 0)
        is_long = buy_signals > sell_signals
        is_short = sell_signals > buy_signals
    
    # PENALTY #3: Volume –Ω–∞ –∫–æ—Ä–æ—Ç–∫–∏—Ö TF (–¥–ª—è —Å–∫–∞–ª—å–ø–∏–Ω–≥–∞)
    entry_timeframe = entry_plan.get('entry_timeframe', '5m') if entry_plan else '5m'
    
    if entry_timeframe in ['1m', '5m', '15m']:
        volume_penalties = self._check_scalping_volume_penalties(analysis, entry_timeframe, is_long)
        if volume_penalties:
            total_vol_penalty = sum(volume_penalties.values())
            score += total_vol_penalty
            penalties.append(f"Low volume on short TF: {total_vol_penalty:.1f}")
            breakdown['volume_penalties'] = volume_penalties
            warnings.append(f"‚ö†Ô∏è Low volume detected on {entry_timeframe}")
    
    # PENALTY #4: MACD Alignment –Ω–∞ –∫–æ—Ä–æ—Ç–∫–∏—Ö TF
    if entry_timeframe in ['1m', '5m', '15m']:
        macd_penalty = self._check_macd_alignment_penalty(analysis, is_long, entry_timeframe)
        if macd_penalty < 0:
            score += macd_penalty
            penalties.append(f"MACD contradiction: {macd_penalty:.1f}")
            breakdown['macd_penalty'] = macd_penalty
            warnings.append("‚ö†Ô∏è MACD contradicts direction on short timeframes")
    
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    # SCORING PHASE: –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—ã—á–Ω—ã–π scoring (—Å—Ç—Ä–æ–∫–∏ 589-817)
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    
    h4_data = analysis.get('timeframes', {}).get('4h', {})
    current_price = ticker['price']
    
    # ... (–≤–µ—Å—å –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ scoring –ë–ï–ó –∏–∑–º–µ–Ω–µ–Ω–∏–π, —Å—Ç—Ä–æ–∫–∏ 589-817)
    
    # –ù–û–í–´–ô MAXIMUM: 20 points (–Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º –ø–æ—Å–ª–µ penalties!)
    final_score = min(20.0, max(-5.0, score))  # –†–∞–∑—Ä–µ—à–∞–µ–º –¥–æ -5.0 –¥–ª—è –æ—á–µ–Ω—å –ø–ª–æ—Ö–∏—Ö
    
    # –î–æ–±–∞–≤–ª—è–µ–º penalties –∏ warnings –≤ breakdown
    breakdown['penalties_applied'] = penalties
    breakdown['warnings'] = warnings
    breakdown['penalties_total'] = sum([
        p for p in breakdown.values() 
        if isinstance(p, (int, float)) and p < 0
    ])
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º warning —Å–æ–æ–±—â–µ–Ω–∏–µ
    warning = self._generate_warning_from_penalties(penalties, warnings) if penalties else None
    
    return {
        "total": final_score,
        "breakdown": breakdown,
        "system": "20-point-advanced-with-penalties",
        "blocked": False,  # –ù–ï –±–ª–æ–∫–∏—Ä—É–µ–º, —Ç–æ–ª—å–∫–æ —Å–Ω–∏–∂–∞–µ–º score
        "reason": None,
        "warning": warning
    }
```

### –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #2: –î–æ–±–∞–≤–∏—Ç—å `_check_scalping_volume_penalties()`

**–§–∞–π–ª:** `mcp_server/market_scanner.py`  
**–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ –ü–û–°–õ–ï `_calculate_opportunity_score()`:**

```python
def _check_scalping_volume_penalties(
    self,
    analysis: Dict,
    entry_timeframe: str,
    is_long: bool
) -> Dict[str, float]:
    """
    –ü—Ä–æ–≤–µ—Ä–∫–∞ volume –Ω–∞ –∫–æ—Ä–æ—Ç–∫–∏—Ö TF –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ penalties
    
    Args:
        analysis: –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∞–∫—Ç–∏–≤–∞
        entry_timeframe: –¢–∞–π–º—Ñ—Ä–µ–π–º –≤—Ö–æ–¥–∞ ('1m', '5m', '15m')
        is_long: True –¥–ª—è LONG, False –¥–ª—è SHORT
    
    Returns:
        Dict —Å penalties –ø–æ –∫–∞–∂–¥–æ–º—É TF: {"1m": -1.5, "5m": -1.0, ...}
    """
    penalties = {}
    short_tfs = ['1m', '5m', '15m']
    
    for tf in short_tfs:
        tf_data = analysis.get('timeframes', {}).get(tf, {})
        if 'error' in tf_data:
            continue
        
        vol_data = tf_data.get('indicators', {}).get('volume', {})
        vol_ratio = vol_data.get('volume_ratio', 1.0)
        
        # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∏–π volume (<0.3)
        if vol_ratio < 0.3:
            if tf == entry_timeframe:
                penalties[tf] = -2.0  # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π penalty –Ω–∞ entry TF
            else:
                penalties[tf] = -1.5  # –ë–æ–ª—å—à–æ–π penalty –Ω–∞ –¥—Ä—É–≥–∏—Ö TF
        
        # –ù–∏–∑–∫–∏–π volume –¥–ª—è —Å–∫–∞–ª—å–ø–∏–Ω–≥–∞ (<0.5)
        elif vol_ratio < 0.5:
            if tf == '1m':
                penalties[tf] = -1.5
            elif tf == '5m':
                penalties[tf] = -1.0
            elif tf == '15m':
                penalties[tf] = -0.5
        
        # –£–º–µ—Ä–µ–Ω–Ω–æ –Ω–∏–∑–∫–∏–π volume (<0.7) - —Ç–æ–ª—å–∫–æ –Ω–∞ entry TF
        elif vol_ratio < 0.7 and tf == entry_timeframe:
            penalties[tf] = -0.5
    
    return penalties
```

### –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #3: –î–æ–±–∞–≤–∏—Ç—å `_check_macd_alignment_penalty()`

**–§–∞–π–ª:** `mcp_server/market_scanner.py`  
**–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ –ü–û–°–õ–ï `_check_scalping_volume_penalties()`:**

```python
def _check_macd_alignment_penalty(
    self,
    analysis: Dict,
    is_long: bool,
    entry_timeframe: str
) -> float:
    """
    –ü—Ä–æ–≤–µ—Ä–∫–∞ MACD alignment –Ω–∞ –∫–æ—Ä–æ—Ç–∫–∏—Ö TF
    
    Args:
        analysis: –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∞–∫—Ç–∏–≤–∞
        is_long: True –¥–ª—è LONG, False –¥–ª—è SHORT
        entry_timeframe: –¢–∞–π–º—Ñ—Ä–µ–π–º –≤—Ö–æ–¥–∞
    
    Returns:
        Penalty (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ) –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è, 0.0 –µ—Å–ª–∏ OK
    """
    short_tfs = ['1m', '5m', '15m']
    bearish_count = 0
    bullish_count = 0
    macd_details = {}
    
    for tf in short_tfs:
        tf_data = analysis.get('timeframes', {}).get(tf, {})
        if 'error' in tf_data:
            continue
        
        macd = tf_data.get('indicators', {}).get('macd', {})
        crossover = macd.get('crossover', 'neutral')
        macd_details[tf] = crossover
        
        if crossover == 'bearish':
            bearish_count += 1
        elif crossover == 'bullish':
            bullish_count += 1
    
    # Penalty –¥–ª—è LONG –µ—Å–ª–∏ MACD bearish
    if is_long:
        if bearish_count >= 2:
            return -1.5  # 2+ TF –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç bearish ‚Üí –±–æ–ª—å—à–æ–π penalty
        elif bearish_count >= 1:
            return -0.5  # 1 TF bearish ‚Üí –Ω–µ–±–æ–ª—å—à–æ–π penalty
    
    # Penalty –¥–ª—è SHORT –µ—Å–ª–∏ MACD bullish
    else:  # is_short
        if bullish_count >= 2:
            return -1.5  # 2+ TF –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç bullish ‚Üí –±–æ–ª—å—à–æ–π penalty
        elif bullish_count >= 1:
            return -0.5  # 1 TF bullish ‚Üí –Ω–µ–±–æ–ª—å—à–æ–π penalty
    
    return 0.0  # –ù–µ—Ç –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π
```

### –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #4: –ò—Å–ø—Ä–∞–≤–∏—Ç—å `_estimate_probability()`

**–§–∞–π–ª:** `mcp_server/market_scanner.py`  
**–§—É–Ω–∫—Ü–∏—è:** `_estimate_probability()` (—Å—Ç—Ä–æ–∫–∏ 842-871)

**–ó–ê–ú–ï–ù–ò–¢–¨ –ø–æ–ª–Ω–æ—Å—Ç—å—é:**

```python
def _estimate_probability(self, score: float, analysis: Dict) -> float:
    """
    –û—Ü–µ–Ω–∫–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —É—Å–ø–µ—Ö–∞ - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
    
    Args:
        score: Confluence score (0-20, raw, –ú–û–ñ–ï–¢ –ë–´–¢–¨ –û–¢–†–ò–¶–ê–¢–ï–õ–¨–ù–´–ú –ø–æ—Å–ª–µ penalties!)
        analysis: –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∞–∫—Ç–∏–≤–∞
    
    Returns:
        –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É—Å–ø–µ—Ö–∞ (0.25-0.75) - –†–ï–ê–õ–ò–°–¢–ò–ß–ù–ê–Ø!
    """
    composite = analysis.get('composite_signal', {})
    signal = composite.get('signal', 'HOLD')
    confidence = composite.get('confidence', 0.5)
    comp_score = abs(composite.get('score', 0))
    
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    # HARD STOP: HOLD —Å –Ω–∏–∑–∫–æ–π confidence ‚Üí –æ—á–µ–Ω—å –Ω–∏–∑–∫–∞—è probability
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    if signal == 'HOLD' and confidence < 0.5:
        return 0.30  # –ú–∏–Ω–∏–º—É–º 30% –¥–ª—è HOLD —Å –Ω–∏–∑–∫–æ–π confidence
    
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    # –ë–∞–∑–æ–≤–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—Ç score (20-point ‚Üí 25-75%)
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    # Score –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º –ø–æ—Å–ª–µ penalties!
    # Score 0.0 = 25%, Score 5.0 = 30%, Score 10.0 = 45%, Score 15.0 = 60%, Score 20.0 = 75%
    base_score = max(0.0, score)  # –ù–µ –ø–æ–∑–≤–æ–ª—è–µ–º –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–º—É score —Å–Ω–∏–∂–∞—Ç—å –Ω–∏–∂–µ 25%
    base_prob = 0.25 + (base_score - 0.0) * 0.025  # 0.0=25%, 20.0=75%
    base_prob = max(0.25, min(0.75, base_prob))  # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º 25-75%
    
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    # –ö–†–ò–¢–ò–ß–ù–û: Confidence –∫–∞–∫ MULTIPLIER (–Ω–µ –º–∏–Ω–∏–º—É–º!)
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    # –ï—Å–ª–∏ confidence = 0.5, —Ç–æ probability = 50% –æ—Ç base
    # –ï—Å–ª–∏ confidence = 0.8, —Ç–æ probability = 80% –æ—Ç base
    # –ï—Å–ª–∏ confidence = 0.3, —Ç–æ probability = 30% –æ—Ç base (–Ω–æ –º–∏–Ω–∏–º—É–º 25%)
    confidence_multiplier = max(0.3, confidence)  # –ú–∏–Ω–∏–º—É–º 30% –æ—Ç confidence
    adjusted_prob = base_prob * confidence_multiplier
    
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    # –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ signal type
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    if signal == 'STRONG_BUY' or signal == 'STRONG_SELL':
        adjusted_prob *= 1.1  # +10% –∑–∞ strong signal
    elif signal == 'BUY' or signal == 'SELL':
        adjusted_prob *= 1.0  # –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    elif signal == 'HOLD':
        adjusted_prob *= 0.5  # -50% –∑–∞ HOLD (–¥–∞–∂–µ –µ—Å–ª–∏ confidence OK)
    
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    # –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ composite score
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    if comp_score < 3:
        adjusted_prob *= 0.7  # –ï—â—ë –±–æ–ª—å—à–µ —Å–Ω–∏–∂–∞–µ–º –ø—Ä–∏ —Å–ª–∞–±–æ–º composite score
    elif comp_score > 7:
        adjusted_prob *= 1.05  # –ù–µ–±–æ–ª—å—à–æ–π –±–æ–Ω—É—Å –∑–∞ —Å–∏–ª—å–Ω—ã–π composite score
    
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    # –§–∏–Ω–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    final_prob = min(0.75, max(0.25, adjusted_prob))  # 25-75% –º–∞–∫—Å–∏–º—É–º!
    
    return round(final_prob, 2)
```

### –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #5: –î–æ–±–∞–≤–∏—Ç—å `_generate_warning_from_penalties()`

**–§–∞–π–ª:** `mcp_server/market_scanner.py`  
**–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ –ü–û–°–õ–ï `_check_macd_alignment_penalty()`:**

```python
def _generate_warning_from_penalties(
    self, 
    penalties: List[str], 
    warnings: List[str] = None
) -> Optional[str]:
    """
    –ì–µ–Ω–µ—Ä–∞—Ü–∏—è warning —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ —Å–ø–∏—Å–∫–∞ penalties
    
    Args:
        penalties: –°–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∫ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º penalties
        warnings: –°–ø–∏—Å–æ–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö warnings
    
    Returns:
        Warning —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–ª–∏ None
    """
    if not penalties:
        return None
    
    # –í—ã—á–∏—Å–ª—è–µ–º –æ–±—â–∏–π penalty
    total_penalty = 0.0
    for p in penalties:
        if ':' in p:
            try:
                penalty_value = float(p.split(':')[-1].strip())
                total_penalty += penalty_value
            except ValueError:
                continue
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º warning –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç severity
    if total_penalty <= -6.0:
        severity = "üî¥ CRITICAL"
        message = f"Multiple critical issues detected ({len(penalties)} penalties, total: {total_penalty:.1f})"
    elif total_penalty <= -4.0:
        severity = "üî¥ HIGH RISK"
        message = f"Several serious issues detected ({len(penalties)} penalties, total: {total_penalty:.1f})"
    elif total_penalty <= -2.0:
        severity = "‚ö†Ô∏è WARNING"
        message = f"Some issues detected ({len(penalties)} penalties, total: {total_penalty:.1f})"
    else:
        severity = "‚ö†Ô∏è"
        message = f"Minor issues: {', '.join(penalties[:2])}"
    
    # –î–æ–±–∞–≤–ª—è–µ–º –¥–µ—Ç–∞–ª–∏ –µ—Å–ª–∏ –µ—Å—Ç—å warnings
    if warnings:
        message += f" | {', '.join(warnings[:2])}"
    
    return f"{severity} {message}"
```

### –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #6: –£–ª—É—á—à–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —Å—Ç–µ–π–±–ª/—Å—Ç–µ–π–±–ª –ø–∞—Ä –≤ `scan_market()`

**–§–∞–π–ª:** `mcp_server/market_scanner.py`  
**–§—É–Ω–∫—Ü–∏—è:** `scan_market()` (—Å—Ç—Ä–æ–∫–∏ 66-500)

**–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤ `analyze_ticker()` (–ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 220):**

```python
async def analyze_ticker(ticker: Dict[str, Any]) -> Optional[Dict[str, Any]]:
    """–ê–Ω–∞–ª–∏–∑ –æ–¥–Ω–æ–≥–æ —Ç–∏–∫–µ—Ä–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫"""
    
    # Skip if already in open positions
    if ticker['symbol'] in open_positions_symbols:
        return None
    
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    # –ù–û–í–û–ï: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å—Ç–µ–π–±–ª/—Å—Ç–µ–π–±–ª –ø–∞—Ä
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    if self._is_stable_stable_pair(ticker['symbol']):
        logger.debug(f"Skipping stable/stable pair: {ticker['symbol']}")
        return None
    
    async with semaphore:
        try:
            # ... (–æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
```

**–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `_is_stable_stable_pair()` –≤ –∫–ª–∞—Å—Å MarketScanner:**

```python
@staticmethod
def _is_stable_stable_pair(symbol: str) -> bool:
    """
    –ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–∞—Ä–∞ –°–¢–ï–ô–ë–õ/–°–¢–ï–ô–ë–õ
    
    –ò—Å–∫–ª—é—á–∞–µ–º:
    - USDC/USDT, BUSD/USDT (—Å—Ç–µ–π–±–ª/—Å—Ç–µ–π–±–ª)
    - USDT/TRY, USDT/BRL (—Å—Ç–µ–π–±–ª/—Ñ–∏–∞—Ç)
    - RLUSD/USDT –∏ –ø–æ–¥–æ–±–Ω—ã–µ
    
    –ù–ï –∏—Å–∫–ª—é—á–∞–µ–º:
    - BTC/USDT, ETH/USDT (–∫—Ä–∏–ø—Ç–∞/—Å—Ç–µ–π–±–ª)
    """
    if not symbol:
        return False
    
    # –°–ø–∏—Å–æ–∫ —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö –º–æ–Ω–µ—Ç –∏ —Ñ–∏–∞—Ç–æ–≤
    stablecoins = {
        'USDT', 'USDC', 'BUSD', 'DAI', 'TUSD', 
        'USDP', 'USDD', 'FRAX', 'LUSD', 'MIM', 'RLUSD'
    }
    fiats = {'TRY', 'BRL', 'EUR', 'GBP', 'AUD', 'RUB'}
    stable_and_fiat = stablecoins | fiats
    
    # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Å–∏–º–≤–æ–ª
    symbol_upper = symbol.upper().replace('/', '').replace('-', '').replace(':', '')
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
    for stable1 in stable_and_fiat:
        if symbol_upper.endswith(stable1):
            base = symbol_upper[:-len(stable1)]
            if base in stable_and_fiat:
                return True
        if symbol_upper.startswith(stable1):
            quote = symbol_upper[len(stable1):]
            if quote in stable_and_fiat:
                return True
    
    return False
```

### –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #7: –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Å–∏–≥–Ω–∞–ª—ã –í–°–ï–ì–î–ê –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è

**–§–∞–π–ª:** `mcp_server/market_scanner.py`  
**–§—É–Ω–∫—Ü–∏—è:** `scan_market()` (—Å—Ç—Ä–æ–∫–∏ 360-490)

**–£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ SmartDisplay.select_top_3_with_warnings() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è:**

```python
# –í —Å—Ç—Ä–æ–∫–µ 361-371 —É–∂–µ –µ—Å—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–¥:
top_longs = SmartDisplay.select_top_3_with_warnings(
    all_longs[:limit],
    adaptive_thresholds["long"],
    market_regime
)

top_shorts = SmartDisplay.select_top_3_with_warnings(
    all_shorts[:limit],
    adaptive_thresholds["short"],
    market_regime
)

# ‚úÖ –£–ë–ï–î–ò–¢–¨–°–Ø —á—Ç–æ –¥–∞–∂–µ –µ—Å–ª–∏ —Å–∏–≥–Ω–∞–ª–æ–≤ –º–∞–ª–æ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ª—É—á—à–∏–µ:
if len(top_longs) < 3 and len(all_longs) > 0:
    # –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∏–∑ all_longs (–¥–∞–∂–µ –µ—Å–ª–∏ score –Ω–∏–∑–∫–∏–π)
    for opp in all_longs[len(top_longs):3]:
        if opp.get("score", 0) >= 3.0:  # –ú–∏–Ω–∏–º—É–º 3.0/20
            top_longs.append(opp)

if len(top_shorts) < 3 and len(all_shorts) > 0:
    # –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∏–∑ all_shorts
    for opp in all_shorts[len(top_shorts):3]:
        if opp.get("score", 0) >= 3.0:  # –ú–∏–Ω–∏–º—É–º 3.0/20
            top_shorts.append(opp)
```

---

## üìä –ü–†–ò–ú–ï–†–´ –†–ê–ë–û–¢–´

### –ü—Ä–∏–º–µ—Ä 1: ZEN/USDT (–õ–æ–∂–Ω—ã–π —Å–∏–≥–Ω–∞–ª - –î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

**–î–û:**
```
Composite signal: HOLD
Confidence: 0.15
Volume 1m: 0.11, Volume 5m: 0.04
MACD 1m: bearish, MACD 5m: bearish
Score: 8.46/20
Probability: 95%
Tier: "professional"
–†–µ–∑—É–ª—å—Ç–∞—Ç: –£–±—ã—Ç–æ–∫ -$0.35
```

**–ü–û–°–õ–ï:**
```
Composite signal: HOLD ‚Üí penalty -2.0
Confidence: 0.15 < 0.4 ‚Üí penalty -1.5
Volume 1m: 0.11 < 0.3 ‚Üí penalty -2.0
Volume 5m: 0.04 < 0.3 ‚Üí penalty -1.0
MACD 1m+5m: 2 bearish ‚Üí penalty -1.5
Total penalties: -8.0
Score: 8.46 - 8.0 = 0.46/20 ‚úÖ
Probability: 0.30 (HOLD + low confidence) ‚úÖ
Tier: "not_recommended" ‚úÖ
Warning: "üî¥ CRITICAL: Multiple critical issues detected (5 penalties, total: -8.0)"
–†–µ–∑—É–ª—å—Ç–∞—Ç: –°–∏–≥–Ω–∞–ª –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º warning, –ù–ï —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è
```

### –ü—Ä–∏–º–µ—Ä 2: –•–æ—Ä–æ—à–∏–π Setup (–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª)

**–î–û –∏ –ü–û–°–õ–ï:**
```
Composite signal: STRONG_BUY
Confidence: 0.85
Volume 1m: 1.2, Volume 5m: 1.5
MACD 1m: bullish, MACD 5m: bullish
Score: 16.5/20 (–±–µ–∑ penalties) ‚úÖ
Probability: 0.75 (base 0.60 * confidence 0.85 * strong 1.1 = 0.70, +5% bonus = 0.75) ‚úÖ
Tier: "elite" ‚úÖ
Warning: None ‚úÖ
–†–µ–∑—É–ª—å—Ç–∞—Ç: –û—Ç–ª–∏—á–Ω—ã–π —Å–∏–≥–Ω–∞–ª, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—é
```

---

## ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–ê–í–ò–õ–ê

### –ü—Ä–∞–≤–∏–ª–æ #1: Penalties –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ü–ï–†–ï–î –æ—Å–Ω–æ–≤–Ω—ã–º scoring
```
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å composite signal ‚Üí penalty
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å confidence ‚Üí penalty
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å volume –Ω–∞ –∫–æ—Ä–æ—Ç–∫–∏—Ö TF ‚Üí penalty
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å MACD alignment ‚Üí penalty
5. –ü–†–ò–ú–ï–ù–ò–¢–¨ penalties –∫ score
6. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–±—ã—á–Ω—ã–π scoring
```

### –ü—Ä–∞–≤–∏–ª–æ #2: Probability –ù–ò–ö–û–ì–î–ê –Ω–µ –≤—ã—à–µ 75%
```
–ú–∞–∫—Å–∏–º—É–º: 75% (–¥–∞–∂–µ –¥–ª—è –æ—Ç–ª–∏—á–Ω—ã—Ö setups)
–ú–∏–Ω–∏–º—É–º: 25% (–¥–∞–∂–µ –¥–ª—è –ø–ª–æ—Ö–∏—Ö setups)
–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ: 30-70% –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞
```

### –ü—Ä–∞–≤–∏–ª–æ #3: –í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ª—É—á—à–∏–µ —Å–∏–≥–Ω–∞–ª—ã
```
- –ù–ï —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ score <3.0
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –¥–∞–∂–µ "high_risk" —Å warnings
- –ú–∏–Ω–∏–º—É–º: score 3.0/20, probability 25%
- SmartDisplay –¥–æ–±–∞–≤–∏—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ warnings
- Tier system –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç
```

### –ü—Ä–∞–≤–∏–ª–æ #4: Volume –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞ entry timeframe
```
–ï—Å–ª–∏ entry_timeframe = "5m":
  ‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å volume –Ω–∞ 5m (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  ‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å volume –Ω–∞ 1m (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ)
  ‚Üí Penalty –µ—Å–ª–∏ volume <0.5 –Ω–∞ entry TF
  ‚Üí –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π penalty –µ—Å–ª–∏ volume <0.3
```

### –ü—Ä–∞–≤–∏–ª–æ #5: MACD –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–∫–∞–ª—å–ø–∏–Ω–≥–∞
```
–ï—Å–ª–∏ entry_timeframe in ["1m", "5m", "15m"]:
  ‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å MACD –Ω–∞ 1m, 5m, 15m
  ‚Üí Penalty –µ—Å–ª–∏ 2+ TF –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é ‚Üí -1.5
  ‚Üí Penalty –µ—Å–ª–∏ 1 TF –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç ‚Üí -0.5
```

### –ü—Ä–∞–≤–∏–ª–æ #6: –°—Ç–µ–π–±–ª/—Å—Ç–µ–π–±–ª –ø–∞—Ä—ã —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
```
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ analyze_ticker() –ø–µ—Ä–µ–¥ –∞–Ω–∞–ª–∏–∑–æ–º
- –ò—Å–∫–ª—é—á–∞–µ–º: USDC/USDT, BUSD/USDT, USDT/TRY –∏ —Ç.–¥.
- –ù–ï –∏—Å–∫–ª—é—á–∞–µ–º: BTC/USDT, ETH/USDT (–∫—Ä–∏–ø—Ç–∞/—Å—Ç–µ–π–±–ª)
```

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –¢–µ—Å—Ç 1: HOLD —Å–∏–≥–Ω–∞–ª —Å –Ω–∏–∑–∫–æ–π confidence
```python
# Input
signal = "HOLD"
confidence = 0.15
score_before = 8.0

# Expected
penalty_hold = -2.0
penalty_low_conf = -1.5
score_after = 8.0 - 2.0 - 1.5 = 4.5
probability = 0.30  # HOLD + low confidence
tier = "high_risk"  # score 4.5 < 5.0
warning = "üî¥ CRITICAL: Multiple critical issues detected"
```

### –¢–µ—Å—Ç 2: –ù–∏–∑–∫–∏–π volume –Ω–∞ 5m
```python
# Input
entry_timeframe = "5m"
volume_5m = 0.11  # <0.3

# Expected
penalty_volume = -2.0  # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∏–π –Ω–∞ entry TF
score_after = score_before - 2.0
warning = "‚ö†Ô∏è Low volume detected on 5m"
```

### –¢–µ—Å—Ç 3: MACD bearish –¥–ª—è LONG
```python
# Input
is_long = True
macd_1m = "bearish"
macd_5m = "bearish"

# Expected
penalty_macd = -1.5  # 2+ TF –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—Ç
score_after = score_before - 1.5
warning = "‚ö†Ô∏è MACD contradicts direction on short timeframes"
```

### –¢–µ—Å—Ç 4: –°—Ç–µ–π–±–ª/—Å—Ç–µ–π–±–ª –ø–∞—Ä–∞
```python
# Input
symbol = "USDC/USDT"

# Expected
_is_stable_stable_pair("USDC/USDT") = True
analyze_ticker() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç None (–ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è)
```

### –¢–µ—Å—Ç 5: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π score –¥–ª—è –ø–æ–∫–∞–∑–∞
```python
# Input
score = 3.5/20
probability = 0.28

# Expected
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö (score >= 3.0, probability >= 0.25)
Tier: "high_risk"
Warning: "üî¥ HIGH RISK: Score below recommended threshold"
```

---

## üìù –ß–ï–ö–õ–ò–°–¢ –í–ù–ï–î–†–ï–ù–ò–Ø

- [ ] –î–æ–±–∞–≤–∏—Ç—å penalties –≤ `_calculate_opportunity_score()` (–ü–ï–†–ï–î scoring)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `_check_scalping_volume_penalties()`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `_check_macd_alignment_penalty()`
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `_estimate_probability()` (—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ 25-75%)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `_generate_warning_from_penalties()`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `_is_stable_stable_pair()` –≤ MarketScanner
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç–µ–π–±–ª/—Å—Ç–µ–π–±–ª –ø–∞—Ä –≤ `analyze_ticker()`
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ SmartDisplay –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ø-3 (–¥–∞–∂–µ –µ—Å–ª–∏ score –Ω–∏–∑–∫–∏–π)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ ZEN/USDT –¥–∞–Ω–Ω—ã—Ö (–¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∏—Ç—å score ~0.5, probability 30%)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ö–æ—Ä–æ—à–∏—Ö setups (–¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Ä–∞–Ω—å—à–µ)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ tier classification —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Å–∏–≥–Ω–∞–ª—ã –í–°–ï–ì–î–ê –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è (–º–∏–Ω–∏–º—É–º 3.0/20, probability 25%+)

---

## üéØ –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
- ‚ùå False positive rate: ~30-40%
- ‚ùå Probability accuracy: ~60% (–∑–∞–≤—ã—à–µ–Ω–∞ –Ω–∞ 20-30%)
- ‚ùå Win rate: ~50-60%
- ‚ùå ZEN/USDT: score 8.46, probability 95% ‚Üí —É–±—ã—Ç–æ–∫

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
- ‚úÖ False positive rate: <10%
- ‚úÖ Probability accuracy: ~85-90% (—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏)
- ‚úÖ Win rate: ~70-80% (—Ç–æ–ª—å–∫–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã –≤ —Ç–æ–ø-3)
- ‚úÖ ZEN/USDT: score 0.46, probability 30% ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º warning
- ‚úÖ –°–ª–∞–±—ã–µ —Å–∏–≥–Ω–∞–ª—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ "high_risk" –∏–ª–∏ "not_recommended"
- ‚úÖ –í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ª—É—á—à–∏–µ –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ (–º–∏–Ω–∏–º—É–º 3.0/20)
- ‚úÖ –°—Ç–µ–π–±–ª/—Å—Ç–µ–π–±–ª –ø–∞—Ä—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–∫–ª—é—á–µ–Ω—ã

---

## üîç –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø

### –£–ª—É—á—à–µ–Ω–∏–µ #1: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ penalties
```python
# –í _calculate_opportunity_score() –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è penalties:
if penalties:
    logger.info(
        f"{ticker.get('symbol', 'UNKNOWN')}: Applied {len(penalties)} penalties, "
        f"total: {sum([p for p in breakdown.values() if isinstance(p, (int, float)) and p < 0]):.1f}, "
        f"final score: {final_score:.2f}/20"
    )
```

### –£–ª—É—á—à–µ–Ω–∏–µ #2: –î–µ—Ç–∞–ª—å–Ω—ã–π breakdown –≤ –æ—Ç–≤–µ—Ç–µ
```python
# –í return statement –¥–æ–±–∞–≤–∏—Ç—å:
"penalties_breakdown": {
    "hold_penalty": breakdown.get('hold_penalty', 0),
    "confidence_penalty": breakdown.get('low_confidence_penalty', 0),
    "volume_penalties": breakdown.get('volume_penalties', {}),
    "macd_penalty": breakdown.get('macd_penalty', 0),
    "total": breakdown.get('penalties_total', 0)
}
```

---

**–í–µ—Ä—Å–∏—è:** 2.0 FINAL  
**–°—Ç–∞—Ç—É—Å:** –ì–û–¢–û–í–û –ö –í–ù–ï–î–†–ï–ù–ò–Æ  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û  
**–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ:** –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
