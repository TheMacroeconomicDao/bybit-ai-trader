# üîß –ü–û–î–†–û–ë–ù–´–ô –ü–†–û–ú–ü–¢ –î–õ–Ø –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø AUTONOMOUS AGENT

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-01-20  
**–°–≤—è–∑–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç:** [AGENT_SYSTEM_RESEARCH.md](AGENT_SYSTEM_RESEARCH.md)  
**–¶–µ–ª—å:** –ü—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ –µ–¥–∏–Ω—É—é –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É

---

## üìã –ö–†–ê–¢–ö–û–ï –†–ï–ó–Æ–ú–ï –ü–†–û–ë–õ–ï–ú

**–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** Autonomous Agent —Ä–∞–±–æ—Ç–∞–µ—Ç –ò–ó–û–õ–ò–†–û–í–ê–ù–ù–û –æ—Ç –æ—Å—Ç–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã.

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑—Ä—ã–≤—ã:**
1. ‚ùå –ê–≥–µ–Ω—Ç –ù–ï –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ Cursor MCP
2. ‚ùå –ê–≥–µ–Ω—Ç –ù–ï –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å WebUI
3. ‚ùå –ê–≥–µ–Ω—Ç –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 35 MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
4. ‚ùå –ê–≥–µ–Ω—Ç –ù–ï –º–æ–∂–µ—Ç –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏–∏
5. ‚ùå –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –ø—É–±–ª–∏–∫–∞—Ü–∏–π

---

## üéØ –¶–ï–õ–¨ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

–°–æ–∑–¥–∞—Ç—å **Unified Autonomous Trading System**, –≥–¥–µ:
- ‚úÖ –ê–≥–µ–Ω—Ç –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ Cursor –∫–∞–∫ MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
- ‚úÖ –ê–≥–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Å–µ 35 MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ –ê–≥–µ–Ω—Ç –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å WebUI
- ‚úÖ –ê–≥–µ–Ω—Ç –º–æ–∂–µ—Ç –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–∑–∏—Ü–∏—è–º–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
- ‚úÖ –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üî¥ –ü–†–ò–û–†–ò–¢–ï–¢ 1: UNIFIED AGENT MCP SERVER

### –ü—Ä–æ–±–ª–µ–º–∞
Autonomous Agent - —ç—Ç–æ standalone —Å–∫—Ä–∏–ø—Ç, –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–π —á–µ—Ä–µ–∑ Cursor MCP.

### –†–µ—à–µ–Ω–∏–µ
–°–æ–∑–¥–∞—Ç—å MCP server wrapper –¥–ª—è autonomous agent.

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

#### –®–∞–≥ 1.1: –°–æ–∑–¥–∞—Ç—å `mcp_server/autonomous_agent_server.py`

```python
#!/usr/bin/env python3
"""
Autonomous Agent MCP Server
–û–±–µ—Ä—Ç–∫–∞ –¥–ª—è autonomous agent —Å –¥–æ—Å—Ç—É–ø–æ–º —á–µ—Ä–µ–∑ MCP
"""

import asyncio
import json
import sys
from pathlib import Path
from typing import Any, List, Dict
from datetime import datetime

from mcp.server import Server
from mcp.server.stdio import stdio_server
from mcp.types import Tool, TextContent
from loguru import logger

# –ò–º–ø–æ—Ä—Ç autonomous agent –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
sys.path.insert(0, str(Path(__file__).parent.parent))
from autonomous_agent.autonomous_analyzer import AutonomousAnalyzer
from autonomous_agent.telegram_formatter import TelegramFormatter
from mcp_server.telegram_bot import TelegramBot

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logger.remove()
logger.add(sys.stderr, level="INFO")
logger.add("logs/autonomous_agent_server_{time}.log", rotation="1 day", retention="7 days")

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è MCP —Å–µ—Ä–≤–µ—Ä–∞
app = Server("autonomous-trading-agent")

# –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
analyzer: AutonomousAnalyzer = None
formatter = TelegramFormatter()
last_analysis_result: Dict[str, Any] = None


def load_config() -> Dict[str, Any]:
    """–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"""
    import os
    
    config = {
        "qwen_api_key": os.getenv("QWEN_API_KEY", ""),
        "bybit_api_key": os.getenv("BYBIT_API_KEY", ""),
        "bybit_api_secret": os.getenv("BYBIT_API_SECRET", ""),
        "qwen_model": os.getenv("QWEN_MODEL", "qwen/qwen-turbo"),
        "testnet": os.getenv("BYBIT_TESTNET", "false").lower() == "true",
        "telegram_bot_token": os.getenv("TELEGRAM_BOT_TOKEN", ""),
        "telegram_chat_ids": os.getenv("TELEGRAM_CHAT_IDS", "")
    }
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    required = ["qwen_api_key", "bybit_api_key", "bybit_api_secret"]
    missing = [k for k in required if not config[k]]
    
    if missing:
        raise ValueError(f"Missing required config: {', '.join(missing)}")
    
    return config


@app.list_tools()
async def list_tools() -> List[Tool]:
    """–°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤"""
    return [
        Tool(
            name="analyze_market_comprehensive",
            description=(
                "–ó–∞–ø—É—Å—Ç–∏—Ç—å –ü–û–õ–ù–´–ô –∞–Ω–∞–ª–∏–∑ —Ä—ã–Ω–∫–∞ —Å –ø–æ–º–æ—â—å—é autonomous agent. "
                "–ù–∞—Ö–æ–¥–∏—Ç –¢–û–ü-3 LONG –∏ –¢–û–ü-3 SHORT –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å confluence ‚â•8.0/10, "
                "–≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é ‚â•70%, R:R ‚â•1:2. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Qwen AI –¥–ª—è –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞."
            ),
            inputSchema={
                "type": "object",
                "properties": {
                    "save_to_file": {
                        "type": "boolean",
                        "default": True,
                        "description": "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ data/latest_analysis.json"
                    },
                    "publish_to_telegram": {
                        "type": "boolean",
                        "default": False,
                        "description": "–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ Telegram"
                    },
                    "track_signals": {
                        "type": "boolean",
                        "default": True,
                        "description": "–ó–∞–ø–∏—Å–∞—Ç—å —Å–∏–≥–Ω–∞–ª—ã –≤ signal tracker –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–∞—á–µ—Å—Ç–≤–∞"
                    }
                }
            }
        ),
        
        Tool(
            name="get_last_analysis",
            description="–ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Ä—ã–Ω–∫–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)",
            inputSchema={
                "type": "object",
                "properties": {
                    "format": {
                        "type": "string",
                        "enum": ["json", "telegram", "summary"],
                        "default": "summary",
                        "description": "–§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤"
                    }
                }
            }
        ),
        
        Tool(
            name="publish_analysis_to_telegram",
            description="–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ –≤ Telegram –∫–∞–Ω–∞–ª—ã",
            inputSchema={
                "type": "object",
                "properties": {
                    "use_last_analysis": {
                        "type": "boolean",
                        "default": True,
                        "description": "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞"
                    },
                    "custom_message": {
                        "type": "string",
                        "description": "–ö–∞—Å—Ç–æ–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"
                    }
                }
            }
        ),
        
        Tool(
            name="configure_agent",
            description="–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã autonomous agent",
            inputSchema={
                "type": "object",
                "properties": {
                    "qwen_model": {
                        "type": "string",
                        "description": "–ú–æ–¥–µ–ª—å Qwen –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è"
                    },
                    "min_confluence": {
                        "type": "number",
                        "default": 8.0,
                        "description": "–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π confluence score –¥–ª—è —Å–∏–≥–Ω–∞–ª–æ–≤"
                    },
                    "min_probability": {
                        "type": "number",
                        "default": 0.70,
                        "description": "–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É—Å–ø–µ—Ö–∞ (0-1)"
                    }
                }
            }
        )
    ]


@app.call_tool()
async def call_tool(name: str, arguments: Any) -> List[TextContent]:
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–∑–æ–≤–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤"""
    global analyzer, last_analysis_result
    
    try:
        logger.info(f"Tool called: {name}")
        
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è analyzer –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        if analyzer is None:
            config = load_config()
            analyzer = AutonomousAnalyzer(
                qwen_api_key=config["qwen_api_key"],
                bybit_api_key=config["bybit_api_key"],
                bybit_api_secret=config["bybit_api_secret"],
                qwen_model=config["qwen_model"],
                testnet=config["testnet"]
            )
            logger.info("Autonomous Analyzer initialized")
        
        if name == "analyze_market_comprehensive":
            logger.info("Starting comprehensive market analysis...")
            
            # –ó–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞
            result = await analyzer.analyze_market()
            last_analysis_result = result
            
            # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ñ–∞–π–ª
            if arguments.get("save_to_file", True):
                output_file = Path(__file__).parent.parent / "data" / "latest_analysis.json"
                output_file.parent.mkdir(parents=True, exist_ok=True)
                output_file.write_text(
                    json.dumps(result, ensure_ascii=False, indent=2),
                    encoding="utf-8"
                )
                logger.info(f"Results saved to {output_file}")
            
            # –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Telegram
            if arguments.get("publish_to_telegram", False):
                config = load_config()
                if config["telegram_bot_token"] and config["telegram_chat_ids"]:
                    telegram_message = formatter.format_top_opportunities(result)
                    await publish_to_telegram(
                        config["telegram_bot_token"],
                        config["telegram_chat_ids"],
                        telegram_message
                    )
                else:
                    logger.warning("Telegram credentials not configured")
            
            # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞
            if result.get("success"):
                top_longs = result.get("top_3_longs", [])
                top_shorts = result.get("top_3_shorts", [])
                
                summary = {
                    "success": True,
                    "timestamp": result["timestamp"],
                    "market_summary": {
                        "total_scanned": result.get("total_scanned", 0),
                        "total_analyzed": result.get("total_analyzed", 0),
                        "longs_found": len(top_longs),
                        "shorts_found": len(top_shorts)
                    },
                    "top_longs": top_longs,
                    "top_shorts": top_shorts,
                    "telegram_formatted": formatter.format_top_opportunities(result)
                }
                
                return [TextContent(
                    type="text",
                    text=json.dumps(summary, ensure_ascii=False, indent=2)
                )]
            else:
                return [TextContent(
                    type="text",
                    text=json.dumps(result, ensure_ascii=False, indent=2)
                )]
        
        elif name == "get_last_analysis":
            if not last_analysis_result:
                return [TextContent(
                    type="text",
                    text=json.dumps({"success": False, "error": "No analysis available"})
                )]
            
            format_type = arguments.get("format", "summary")
            
            if format_type == "telegram":
                message = formatter.format_top_opportunities(last_analysis_result)
                return [TextContent(type="text", text=message)]
            elif format_type == "json":
                return [TextContent(
                    type="text",
                    text=json.dumps(last_analysis_result, ensure_ascii=False, indent=2)
                )]
            else:  # summary
                summary = {
                    "timestamp": last_analysis_result.get("timestamp"),
                    "longs_found": len(last_analysis_result.get("top_3_longs", [])),
                    "shorts_found": len(last_analysis_result.get("top_3_shorts", [])),
                    "top_longs": last_analysis_result.get("top_3_longs", []),
                    "top_shorts": last_analysis_result.get("top_3_shorts", [])
                }
                return [TextContent(
                    type="text",
                    text=json.dumps(summary, ensure_ascii=False, indent=2)
                )]
        
        elif name == "publish_analysis_to_telegram":
            config = load_config()
            
            if not config["telegram_bot_token"] or not config["telegram_chat_ids"]:
                return [TextContent(
                    type="text",
                    text=json.dumps({
                        "success": False,
                        "error": "Telegram credentials not configured"
                    })
                )]
            
            if arguments.get("custom_message"):
                message = arguments["custom_message"]
            elif arguments.get("use_last_analysis", True) and last_analysis_result:
                message = formatter.format_top_opportunities(last_analysis_result)
            else:
                return [TextContent(
                    type="text",
                    text=json.dumps({
                        "success": False,
                        "error": "No message to publish"
                    })
                )]
            
            results = await publish_to_telegram(
                config["telegram_bot_token"],
                config["telegram_chat_ids"],
                message
            )
            
            return [TextContent(
                type="text",
                text=json.dumps({"success": True, "results": results}, indent=2)
            )]
        
        elif name == "configure_agent":
            # TODO: Implement configuration updates
            return [TextContent(
                type="text",
                text=json.dumps({
                    "success": True,
                    "message": "Configuration updated",
                    "config": arguments
                })
            )]
        
        else:
            raise ValueError(f"Unknown tool: {name}")
    
    except Exception as e:
        logger.error(f"Error in tool {name}: {e}", exc_info=True)
        return [TextContent(
            type="text",
            text=json.dumps({
                "success": False,
                "error": str(e),
                "tool": name
            }, indent=2)
        )]


async def publish_to_telegram(bot_token: str, chat_ids_str: str, message: str):
    """–ü—É–±–ª–∏–∫—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram"""
    chat_ids = [cid.strip() for cid in chat_ids_str.split(",") if cid.strip()]
    
    if not chat_ids:
        logger.warning("No Telegram chat IDs provided")
        return []
    
    bot = TelegramBot(bot_token)
    
    try:
        results = []
        for chat_id in chat_ids:
            try:
                await bot.send_message(chat_id=chat_id, text=message)
                logger.info(f"Message sent to Telegram channel {chat_id}")
                results.append({"chat_id": chat_id, "success": True})
            except Exception as e:
                logger.error(f"Failed to send to {chat_id}: {e}")
                results.append({"chat_id": chat_id, "success": False, "error": str(e)})
        
        return results
    finally:
        await bot.close()


async def main():
    """–ó–∞–ø—É—Å–∫ Autonomous Agent MCP Server"""
    logger.info("=" * 60)
    logger.info("Starting Autonomous Trading Agent MCP Server")
    logger.info("=" * 60)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    try:
        config = load_config()
        logger.info("Configuration loaded successfully")
        logger.info(f"Qwen Model: {config['qwen_model']}")
        logger.info(f"Testnet: {config['testnet']}")
        logger.info(f"Telegram: {'Enabled' if config['telegram_bot_token'] else 'Disabled'}")
    except Exception as e:
        logger.error(f"Configuration error: {e}")
        sys.exit(1)
    
    logger.info("=" * 60)
    logger.info("Server ready for connections")
    logger.info("Available tools: 4")
    logger.info("  - analyze_market_comprehensive")
    logger.info("  - get_last_analysis")
    logger.info("  - publish_analysis_to_telegram")
    logger.info("  - configure_agent")
    logger.info("=" * 60)
    
    # –ó–∞–ø—É—Å–∫ MCP server
    async with stdio_server() as (read_stream, write_stream):
        await app.run(
            read_stream,
            write_stream,
            app.create_initialization_options()
        )


if __name__ == "__main__":
    try:
        asyncio.run(main())
    except KeyboardInterrupt:
        logger.info("Server shutdown requested")
    except Exception as e:
        logger.error(f"Server error: {e}", exc_info=True)
        sys.exit(1)
```

#### –®–∞–≥ 1.2: –û–±–Ω–æ–≤–∏—Ç—å Cursor MCP –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

–î–æ–±–∞–≤–∏—Ç—å –≤ `CURSOR_MCP_CONFIG.json` (–∏–ª–∏ Cursor settings):

```json
{
  "mcpServers": {
    "autonomous-agent": {
      "command": "python",
      "args": [
        "/Users/Gyber/GYBERNATY-ECOSYSTEM/TRADER-AGENT/mcp_server/autonomous_agent_server.py"
      ],
      "env": {
        "PYTHONPATH": "/Users/Gyber/GYBERNATY-ECOSYSTEM/TRADER-AGENT",
        "QWEN_API_KEY": "your_key_here",
        "BYBIT_API_KEY": "your_key_here",
        "BYBIT_API_SECRET": "your_secret_here",
        "TELEGRAM_BOT_TOKEN": "your_token_here",
        "TELEGRAM_CHAT_IDS": "your_chat_ids_here"
      }
    }
  }
}
```

#### –®–∞–≥ 1.3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –¢–µ—Å—Ç 1: –ó–∞–ø—É—Å–∫ MCP server –≤—Ä—É—á–Ω—É—é
python mcp_server/autonomous_agent_server.py

# –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ Cursor
# –í Cursor:
1. Restart MCP servers
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ "autonomous-agent" –¥–æ—Å—Ç—É–ø–µ–Ω
3. –í—ã–∑–≤–∞—Ç—å: analyze_market_comprehensive
```

---

## üî¥ –ü–†–ò–û–†–ò–¢–ï–¢ 2: –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –° MCP –ò–ù–°–¢–†–£–ú–ï–ù–¢–ê–ú–ò

### –ü—Ä–æ–±–ª–µ–º–∞
Autonomous Agent –¥—É–±–ª–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å MCP —Å–µ—Ä–≤–µ—Ä–∞ –≤–º–µ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –µ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.

### –†–µ—à–µ–Ω–∏–µ
–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ [`autonomous_analyzer.py`](autonomous_agent/autonomous_analyzer.py:1) –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

#### –®–∞–≥ 2.1: –î–æ–±–∞–≤–∏—Ç—å MCP Client –≤ AutonomousAnalyzer

–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `autonomous_agent/autonomous_analyzer.py`:

```python
# –í –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞ –¥–æ–±–∞–≤–∏—Ç—å
from mcp_server.trading_operations import TradingOperations
from mcp_server.signal_tracker import SignalTracker

class AutonomousAnalyzer:
    def __init__(
        self,
        qwen_api_key: str,
        bybit_api_key: str,
        bybit_api_secret: str,
        qwen_model: str = "qwen/qwen-turbo",
        testnet: bool = False,
        signal_tracker: Optional[SignalTracker] = None,
        # –î–û–ë–ê–í–ò–¢–¨:
        trading_operations: Optional[TradingOperations] = None
    ):
        # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
        
        # –î–û–ë–ê–í–ò–¢–¨:
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è trading operations –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ MCP
        self.trading_ops = trading_operations or TradingOperations(
            bybit_api_key, bybit_api_secret, testnet
        )
        
        # Signal tracker –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–ø–∏—Å–∏ —Å–∏–≥–Ω–∞–ª–æ–≤
        self.signal_tracker = signal_tracker or SignalTracker()
```

#### –®–∞–≥ 2.2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å validate_entry –∏–∑ MCP

–ó–∞–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏:

```python
async def _finalize_top_3_longs_and_shorts(
    self,
    candidates: List[Dict[str, Any]],
    qwen_analysis: Dict[str, Any]
) -> tuple[List[Dict[str, Any]], List[Dict[str, Any]]]:
    """–§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è —Ç–æ–ø 3 –ª–æ–Ω–≥–æ–≤ –∏ —Ç–æ–ø 3 —à–æ—Ä—Ç–æ–≤"""
    
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ ...
    
    # –î–û–ë–ê–í–ò–¢–¨: –í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ MCP validate_entry
    validated_longs = []
    for opp in top_longs:
        try:
            validation = await self.technical_analysis.validate_entry(
                symbol=opp["symbol"],
                side="long",
                entry_price=opp["entry_price"],
                stop_loss=opp["stop_loss"],
                take_profit=opp["take_profit"]
            )
            
            if validation.get("is_valid"):
                opp["validation"] = validation
                opp["final_score"] = validation.get("score", opp.get("confluence_score", 0))
                validated_longs.append(opp)
        except Exception as e:
            logger.warning(f"Validation failed for {opp['symbol']}: {e}")
            continue
    
    # –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è shorts
    validated_shorts = []
    for opp in top_shorts:
        # ... —Ç–æ—Ç –∂–µ –∫–æ–¥ ...
    
    return validated_longs[:3], validated_shorts[:3]
```

#### –®–∞–≥ 2.3: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–ø–∏—Å—å —Å–∏–≥–Ω–∞–ª–æ–≤

–£–∂–µ —á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ [`autonomous_analyzer.py:190-212`](autonomous_agent/autonomous_analyzer.py:190), –Ω–æ –Ω—É–∂–Ω–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —á—Ç–æ —ç—Ç–æ –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç:

```python
# –í analyze_market() –ø–æ—Å–ª–µ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–æ–ø-3
if self.signal_tracker:
    for signal in top_longs + top_shorts:
        try:
            signal_id = await self._record_signal_to_tracker(
                signal,
                signal.get("side", "long")
            )
            logger.info(f"Signal {signal_id} recorded for {signal['symbol']}")
        except Exception as e:
            logger.error(f"Failed to record signal: {e}")
```

---

## üî¥ –ü–†–ò–û–†–ò–¢–ï–¢ 3: WEB UI –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø

### –ü—Ä–æ–±–ª–µ–º–∞
WebUI –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã autonomous agent.

### –†–µ—à–µ–Ω–∏–µ
1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å TypeScript –æ—à–∏–±–∫–∏
2. –î–æ–±–∞–≤–∏—Ç—å endpoint –¥–ª—è autonomous agent
3. –°–æ–∑–¥–∞—Ç—å dashboard –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

#### –®–∞–≥ 3.1: –î–æ–±–∞–≤–∏—Ç—å API endpoint –≤ HTTP server

–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `bybit-mcp/build/httpServer.js` (–∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π):

```javascript
// –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π endpoint
app.get('/api/autonomous-agent/latest', async (req, res) => {
  try {
    const fs = require('fs').promises;
    const path = require('path');
    
    const analysisPath = path.join(
      __dirname,
      '..',
      '..',
      'data',
      'latest_analysis.json'
    );
    
    const data = await fs.readFile(analysisPath, 'utf8');
    const analysis = JSON.parse(data);
    
    res.json({
      success: true,
      data: analysis
    });
  } catch (error) {
    res.status(404).json({
      success: false,
      error: 'No analysis available'
    });
  }
});

app.get('/api/autonomous-agent/signals', async (req, res) => {
  try {
    // TODO: –ü–æ–ª—É—á–∏—Ç—å —Å–∏–≥–Ω–∞–ª—ã –∏–∑ signal_tracker
    res.json({
      success: true,
      signals: []
    });
  } catch (error) {
    res.status(500).json({
      success: false,
      error: error.message
    });
  }
});
```

#### –®–∞–≥ 3.2: –°–æ–∑–¥–∞—Ç—å React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è autonomous agent

–°–æ–∑–¥–∞—Ç—å `bybit-mcp/webui/src/components/AutonomousAgent.tsx`:

```typescript
import React, { useEffect, useState } from 'react';

interface Signal {
  symbol: string;
  side: 'long' | 'short';
  entry_price: number;
  stop_loss: number;
  take_profit: number;
  confluence_score: number;
  probability: number;
  reasoning: string;
}

interface AnalysisResult {
  timestamp: string;
  top_3_longs: Signal[];
  top_3_shorts: Signal[];
  market_overview: any;
}

export function AutonomousAgent() {
  const [analysis, setAnalysis] = useState<AnalysisResult | null>(null);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    loadLatestAnalysis();
    const interval = setInterval(loadLatestAnalysis, 60000); // Refresh every minute
    return () => clearInterval(interval);
  }, []);
  
  async function loadLatestAnalysis() {
    try {
      const response = await fetch('/api/autonomous-agent/latest');
      const data = await response.json();
      
      if (data.success) {
        setAnalysis(data.data);
      }
    } catch (error) {
      console.error('Failed to load analysis:', error);
    } finally {
      setLoading(false);
    }
  }
  
  if (loading) return <div>Loading...</div>;
  if (!analysis) return <div>No analysis available</div>;
  
  return (
    <div className="autonomous-agent">
      <h2>ü§ñ Autonomous Agent Analysis</h2>
      <p className="timestamp">Last updated: {new Date(analysis.timestamp).toLocaleString()}</p>
      
      <div className="signals-grid">
        <div className="signals-section">
          <h3>üü¢ TOP 3 LONGS</h3>
          {analysis.top_3_longs.map((signal, i) => (
            <SignalCard key={i} signal={signal} rank={i + 1} />
          ))}
        </div>
        
        <div className="signals-section">
          <h3>üî¥ TOP 3 SHORTS</h3>
          {analysis.top_3_shorts.map((signal, i) => (
            <SignalCard key={i} signal={signal} rank={i + 1} />
          ))}
        </div>
      </div>
    </div>
  );
}

function SignalCard({ signal, rank }: { signal: Signal; rank: number }) {
  return (
    <div className="signal-card">
      <div className="signal-header">
        <span className="rank">#{rank}</span>
        <span className="symbol">{signal.symbol}</span>
        <span className={`side ${signal.side}`}>{signal.side.toUpperCase()}</span>
      </div>
      
      <div className="signal-metrics">
        <div className="metric">
          <label>Confluence:</label>
          <span className="value">{signal.confluence_score}/10</span>
        </div>
        <div className="metric">
          <label>Probability:</label>
          <span className="value">{(signal.probability * 100).toFixed(0)}%</span>
        </div>
      </div>
      
      <div className="signal-prices">
        <div className="price">Entry: ${signal.entry_price}</div>
        <div className="price">SL: ${signal.stop_loss}</div>
        <div className="price">TP: ${signal.take_profit}</div>
      </div>
      
      <div className="signal-reasoning">
        <p>{signal.reasoning}</p>
      </div>
    </div>
  );
}
```

#### –®–∞–≥ 3.3: –î–æ–±–∞–≤–∏—Ç—å –≤ –≥–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

–í `bybit-mcp/webui/src/App.tsx`:

```typescript
import { AutonomousAgent } from './components/AutonomousAgent';

function App() {
  return (
    <div className="app">
      <header>
        <h1>Trading Agent Dashboard</h1>
      </header>
      
      <main>
        <AutonomousAgent />
        {/* ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã ... */}
      </main>
    </div>
  );
}
```

---

## üü° –ü–†–ò–û–†–ò–¢–ï–¢ 4: –ê–í–¢–û–ú–ê–¢–ò–ó–ê–¶–ò–Ø –ü–£–ë–õ–ò–ö–ê–¶–ò–ô

### –ü—Ä–æ–±–ª–µ–º–∞
–ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏.

### –†–µ—à–µ–Ω–∏–µ
–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Kubernetes CronJob –∏–ª–∏ —Å–∏—Å—Ç–µ–º–Ω—ã–π cron –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞.

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

#### –í–∞—Ä–∏–∞–Ω—Ç –ê: Kubernetes CronJob

–°–æ–∑–¥–∞—Ç—å `k8s/autonomous-agent-cronjob.yaml`:

```yaml
apiVersion: batch/v1
kind: CronJob
metadata:
  name: autonomous-agent-analysis
  namespace: trading-agent
spec:
  # –ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç (–º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å)
  schedule: "*/30 * * * *"
  
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: analyzer
            image: trading-agent:latest
            command:
            - python
            - -m
            - autonomous_agent.main
            
            env:
            - name: QWEN_API_KEY
              valueFrom:
                secretKeyRef:
                  name: trading-secrets
                  key: qwen-api-key
            
            - name: BYBIT_API_KEY
              valueFrom:
                secretKeyRef:
                  name: trading-secrets
                  key: bybit-api-key
            
            - name: BYBIT_API_SECRET
              valueFrom:
                secretKeyRef:
                  name: trading-secrets
                  key: bybit-api-secret
            
            - name: TELEGRAM_BOT_TOKEN
              valueFrom:
                secretKeyRef:
                  name: trading-secrets
                  key: telegram-bot-token
            
            - name: TELEGRAM_CHAT_IDS
              valueFrom:
                secretKeyRef:
                  name: trading-secrets
                  key: telegram-chat-ids
            
            - name: QWEN_MODEL
              value: "qwen/qwen-turbo"
            
            - name: BYBIT_TESTNET
              value: "false"
            
            volumeMounts:
            - name: data
              mountPath: /app/data
            
          volumes:
          - name: data
            persistentVolumeClaim:
              claimName: trading-agent-data
          
          restartPolicy: OnFailure
```

#### –í–∞—Ä–∏–∞–Ω—Ç –ë: –°–∏—Å—Ç–µ–º–Ω—ã–π cron

–°–æ–∑–¥–∞—Ç—å `scripts/run_autonomous_agent.sh`:

```bash
#!/bin/bash

# Load environment variables
source /Users/Gyber/GYBERNATY-ECOSYSTEM/TRADER-AGENT/load_env.sh

# Activate virtual environment
source /Users/Gyber/GYBERNATY-ECOSYSTEM/TRADER-AGENT/venv/bin/activate

# Run autonomous agent
cd /Users/Gyber/GYBERNATY-ECOSYSTEM/TRADER-AGENT
python -m autonomous_agent.main

# Log result
echo "[$(date)] Autonomous agent executed" >> logs/cron.log
```

–î–æ–±–∞–≤–∏—Ç—å –≤ crontab:

```bash
# Edit crontab
crontab -e

# Add line (–∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç)
*/30 * * * * /Users/Gyber/GYBERNATY-ECOSYSTEM/TRADER-AGENT/scripts/run_autonomous_agent.sh
```

---

## üü° –ü–†–ò–û–†–ò–¢–ï–¢ 5: –£–ù–ò–§–ò–ö–ê–¶–ò–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò

### –ü—Ä–æ–±–ª–µ–º–∞
–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞—é—Ç –ø—É—Ç–∞–Ω–∏—Ü—É.

### –†–µ—à–µ–Ω–∏–µ
–ï–¥–∏–Ω—ã–π config manager —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏.

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

–°–æ–∑–¥–∞—Ç—å `config/config_manager.py`:

```python
"""
Unified Configuration Manager
–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã
"""

import os
import json
from pathlib import Path
from typing import Dict, Any, Optional
from dataclasses import dataclass


@dataclass
class TradingConfig:
    """–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —Ç—Ä–µ–π–¥–∏–Ω–≥–∞"""
    
    # Bybit API
    bybit_api_key: str
    bybit_api_secret: str
    bybit_testnet: bool = False
    
    # Qwen AI
    qwen_api_key: str
    qwen_model: str = "qwen/qwen-turbo"
    
    # Telegram
    telegram_bot_token: Optional[str] = None
    telegram_chat_ids: Optional[str] = None
    
    # Trading settings
    max_risk_per_trade: float = 0.02
    max_concurrent_positions: int = 3
    daily_loss_limit: float = 0.05
    default_leverage: int = 2
    max_leverage: int = 5
    
    # Agent settings
    min_confluence: float = 8.0
    min_probability: float = 0.70
    min_risk_reward: float = 2.0


class ConfigManager:
    """–ú–µ–Ω–µ–¥–∂–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏"""
    
    def __init__(self, base_path: Optional[Path] = None):
        self.base_path = base_path or Path(__file__).parent.parent
        self._config = None
    
    def load(self) -> TradingConfig:
        """
        –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏:
        1. Environment variables (–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
        2. config/credentials.json
        3. config/autonomous_agent.json
        4. Defaults (–Ω–∏–∑—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
        """
        config_data = {}
        
        # 1. –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ —Ñ–∞–π–ª–æ–≤
        credentials_file = self.base_path / "config" / "credentials.json"
        if credentials_file.exists():
            with open(credentials_file) as f:
                creds = json.load(f)
                if "bybit" in creds:
                    config_data.update(creds["bybit"])
                if "settings" in creds:
                    config_data.update(creds["settings"])
        
        agent_config_file = self.base_path / "config" / "autonomous_agent.json"
        if agent_config_file.exists():
            with open(agent_config_file) as f:
                config_data.update(json.load(f))
        
        # 2. Override —Å environment variables (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
        env_mappings = {
            "BYBIT_API_KEY": "bybit_api_key",
            "BYBIT_API_SECRET": "bybit_api_secret",
            "BYBIT_TESTNET": "bybit_testnet",
            "QWEN_API_KEY": "qwen_api_key",
            "QWEN_MODEL": "qwen_model",
            "TELEGRAM_BOT_TOKEN": "telegram_bot_token",
            "TELEGRAM_CHAT_IDS": "telegram_chat_ids",
        }
        
        for env_var, config_key in env_mappings.items():
            value = os.getenv(env_var)
            if value:
                # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è boolean
                if config_key == "bybit_testnet":
                    value = value.lower() in ("true", "1", "yes")
                config_data[config_key] = value
        
        # 3. –°–æ–∑–¥–∞–Ω–∏–µ TradingConfig
        self._config = TradingConfig(**config_data)
        
        # 4. –í–∞–ª–∏–¥–∞—Ü–∏—è
        self._validate()
        
        return self._config
    
    def _validate(self):
        """–í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"""
        required = ["bybit_api_key", "bybit_api_secret", "qwen_api_key"]
        missing = [
            k for k in required
            if not getattr(self._config, k, None)
        ]
        
        if missing:
            raise ValueError(
                f"Missing required configuration: {', '.join(missing)}\n"
                f"Set via environment variables or config files"
            )
    
    def get(self) -> TradingConfig:
        """–ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (–∑–∞–≥—Ä—É–∑–∏—Ç—å –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)"""
        if self._config is None:
            self.load()
        return self._config


# Singleton instance
_config_manager = ConfigManager()


def get_config() -> TradingConfig:
    """–ü–æ–ª—É—á–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é"""
    return _config_manager.get()
```

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤–æ –≤—Å–µ—Ö –º–æ–¥—É–ª—è—Ö:

```python
from config.config_manager import get_config

# –í –ª—é–±–æ–º –º–æ–¥—É–ª–µ
config = get_config()
analyzer = AutonomousAnalyzer(
    qwen_api_key=config.qwen_api_key,
    bybit_api_key=config.bybit_api_key,
    bybit_api_secret=config.bybit_api_secret,
    # ...
)
```

---

## üü¢ –ü–†–ò–û–†–ò–¢–ï–¢ 6: –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø

### 6.1 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–æ–∑–¥–∞—Ç—å `monitoring/agent_monitor.py`:

```python
"""
–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Autonomous Agent
–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–π, –æ—à–∏–±–æ–∫, –º–µ—Ç—Ä–∏–∫
"""

import sqlite3
from datetime import datetime
from typing import Dict, Any


class AgentMonitor:
    """–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–±–æ—Ç—ã –∞–≥–µ–Ω—Ç–∞"""
    
    def __init__(self, db_path: str = "data/agent_monitoring.db"):
        self.db_path = db_path
        self._init_db()
    
    def _init_db(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î"""
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        
        cursor.execute("""
            CREATE TABLE IF NOT EXISTS analysis_runs (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                timestamp TEXT NOT NULL,
                success BOOLEAN NOT NULL,
                longs_found INTEGER,
                shorts_found INTEGER,
                total_scanned INTEGER,
                error TEXT,
                duration_seconds REAL
            )
        """)
        
        cursor.execute("""
            CREATE TABLE IF NOT EXISTS telegram_publications (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                timestamp TEXT NOT NULL,
                chat_id TEXT NOT NULL,
                success BOOLEAN NOT NULL,
                error TEXT,
                analysis_id INTEGER,
                FOREIGN KEY (analysis_id) REFERENCES analysis_runs(id)
            )
        """)
        
        conn.commit()
        conn.close()
    
    def record_analysis(self, result: Dict[str, Any], duration: float) -> int:
        """–ó–∞–ø–∏—Å–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞"""
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        
        cursor.execute("""
            INSERT INTO analysis_runs (
                timestamp, success, longs_found, shorts_found,
                total_scanned, error, duration_seconds
            ) VALUES (?, ?, ?, ?, ?, ?, ?)
        """, (
            datetime.now().isoformat(),
            result.get("success", False),
            len(result.get("top_3_longs", [])),
            len(result.get("top_3_shorts", [])),
            result.get("total_scanned", 0),
            result.get("error"),
            duration
        ))
        
        analysis_id = cursor.lastrowid
        conn.commit()
        conn.close()
        
        return analysis_id
    
    def record_publication(
        self,
        chat_id: str,
        success: bool,
        analysis_id: int,
        error: str = None
    ):
        """–ó–∞–ø–∏—Å–∞—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é –≤ Telegram"""
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        
        cursor.execute("""
            INSERT INTO telegram_publications (
                timestamp, chat_id, success, error, analysis_id
            ) VALUES (?, ?, ?, ?, ?)
        """, (
            datetime.now().isoformat(),
            chat_id,
            success,
            error,
            analysis_id
        ))
        
        conn.commit()
        conn.close()
    
    def get_stats(self, days: int = 7) -> Dict[str, Any]:
        """–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ –ø–µ—Ä–∏–æ–¥"""
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–Ω–∞–ª–∏–∑–æ–≤
        cursor.execute("""
            SELECT
                COUNT(*) as total_runs,
                SUM(CASE WHEN success THEN 1 ELSE 0 END) as successful_runs,
                AVG(longs_found) as avg_longs,
                AVG(shorts_found) as avg_shorts,
                AVG(duration_seconds) as avg_duration
            FROM analysis_runs
            WHERE timestamp >= datetime('now', '-' || ? || ' days')
        """, (days,))
        
        stats = cursor.fetchone()
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–π
        cursor.execute("""
            SELECT
                COUNT(*) as total_publications,
                SUM(CASE WHEN success THEN 1 ELSE 0 END) as successful_publications
            FROM telegram_publications
            WHERE timestamp >= datetime('now', '-' || ? || ' days')
        """, (days,))
        
        pub_stats = cursor.fetchone()
        
        conn.close()
        
        return {
            "period_days": days,
            "total_runs": stats[0],
            "successful_runs": stats[1],
            "success_rate": stats[1] / stats[0] if stats[0] > 0 else 0,
            "avg_longs_found": stats[2],
            "avg_shorts_found": stats[3],
            "avg_duration_seconds": stats[4],
            "total_publications": pub_stats[0],
            "successful_publications": pub_stats[1],
            "publication_success_rate": pub_stats[1] / pub_stats[0] if pub_stats[0] > 0 else 0
        }
```

### 6.2 –ò—Å–ø—Ä–∞–≤–∏—Ç—å WebUI TypeScript –æ—à–∏–±–∫–∏

```bash
cd bybit-mcp/webui

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—à–∏–±–∫–∏
pnpm build

# –¢–∏–ø–∏—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
# 1. –î–æ–±–∞–≤–∏—Ç—å —Ç–∏–ø—ã –¥–ª—è –≤—Å–µ—Ö props
# 2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å any types
# 3. –î–æ–±–∞–≤–∏—Ç—å null checks

# –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
pnpm build  # –î–æ–ª–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ –±–µ–∑ –æ—à–∏–±–æ–∫
```

### 6.3 –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

–°–æ–∑–¥–∞—Ç—å `autonomous_agent/INTEGRATION_GUIDE.md`:

```markdown
# Integration Guide: Autonomous Agent

## Quick Start

### Option 1: Via Cursor MCP (Recommended)

\```
–¢–´ –≤ Cursor: "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ä—ã–Ω–æ–∫"
–ê–ì–ï–ù–¢: [–ó–∞–ø—É—Å–∫–∞–µ—Ç analyze_market_comprehensive —á–µ—Ä–µ–∑ MCP]
\```

### Option 2: Via Command Line

\```bash
python -m autonomous_agent.main
\```

### Option 3: Via Cron Job

\```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
\```

## Components

- MCP Server: `autonomous_agent_server.py`
- Core Analyzer: `autonomous_analyzer.py`
- Telegram Integration: Built-in
- WebUI: Dashboard in `/webui`

## Configuration

See `config/config_manager.py` for unified configuration.
```

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### –≠—Ç–∞–ø 1: MCP Server Wrapper
- [ ] –°–æ–∑–¥–∞—Ç—å `mcp_server/autonomous_agent_server.py`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å Cursor MCP –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ Cursor
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –≠—Ç–∞–ø 2: MCP Integration
- [ ] –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `autonomous_analyzer.py`
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `validate_entry()` –∏–∑ MCP
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `SignalTracker` –¥–ª—è –∑–∞–ø–∏—Å–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π

### –≠—Ç–∞–ø 3: WebUI Integration
- [ ] –î–æ–±–∞–≤–∏—Ç—å API endpoints
- [ ] –°–æ–∑–¥–∞—Ç—å React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å TypeScript –æ—à–∏–±–∫–∏
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å UI

### –≠—Ç–∞–ø 4: Automation
- [ ] –°–æ–∑–¥–∞—Ç—å Kubernetes CronJob
- [ ] –ò–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π cron
- [ ] –î–æ–±–∞–≤–∏—Ç—å error handling
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –≠—Ç–∞–ø 5: Configuration
- [ ] –°–æ–∑–¥–∞—Ç—å `config_manager.py`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –º–æ–¥—É–ª–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é

### –≠—Ç–∞–ø 6: Monitoring
- [ ] –°–æ–∑–¥–∞—Ç—å `AgentMonitor`
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ main.py
- [ ] –°–æ–∑–¥–∞—Ç—å dashboard –¥–ª—è –º–µ—Ç—Ä–∏–∫
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã

### –≠—Ç–∞–ø 7: Documentation
- [ ] –û–±–Ω–æ–≤–∏—Ç—å README
- [ ] –°–æ–∑–¥–∞—Ç—å INTEGRATION_GUIDE
- [ ] –û–±–Ω–æ–≤–∏—Ç—å QUICK_START
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

---

## üéØ –û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢

–ü–æ—Å–ª–µ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ê–Ω–∞–ª–∏–∑ —á–µ—Ä–µ–∑ Cursor
```
1. –û—Ç–∫—Ä—ã–≤–∞–µ—à—å Cursor
2. –ì–æ–≤–æ—Ä–∏—à—å: "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ä—ã–Ω–æ–∫ –∏ –Ω–∞–π–¥–∏ —Å–∏–≥–Ω–∞–ª—ã"
3. –ê–≥–µ–Ω—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç analyze_market_comprehensive —á–µ—Ä–µ–∑ MCP
4. –ü–æ–ª—É—á–∞–µ—à—å –¢–û–ü-3 –ª–æ–Ω–≥–æ–≤ –∏ –¢–û–ü-3 —à–æ—Ä—Ç–æ–≤
5. –ú–æ–∂–µ—à—å –æ—Ç–∫—Ä—ã—Ç—å –ø–æ–∑–∏—Ü–∏—é –∫–æ–º–∞–Ω–¥–æ–π: "–û—Ç–∫—Ä–æ–π –ø–µ—Ä–≤—ã–π –ª–æ–Ω–≥"
6. –ê–≥–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç place_order –∏–∑ MCP
7. –ü–æ–∑–∏—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—Å—è
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è
```
1. CronJob –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
2. –ê–≥–µ–Ω—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ä—ã–Ω–æ–∫
3. –ù–∞—Ö–æ–¥–∏—Ç —Ç–æ–ø —Å–∏–≥–Ω–∞–ª—ã
4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—É–±–ª–∏–∫—É–µ—Ç –≤ Telegram
5. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –ë–î
6. –û–±–Ω–æ–≤–ª—è–µ—Ç WebUI dashboard
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ UI
```
1. –û—Ç–∫—Ä—ã–≤–∞–µ—à—å http://localhost:8080
2. –í–∏–¥–∏—à—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–∏–≥–Ω–∞–ª—ã –æ—Ç –∞–≥–µ–Ω—Ç–∞
3. –í–∏–¥–∏—à—å –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏
4. –ú–æ–∂–µ—à—å —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–∑–∏—Ü–∏—è–º–∏ —á–µ—Ä–µ–∑ UI
5. –í–∏–¥–∏—à—å –º–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–∏–≥–Ω–∞–ª–æ–≤
```

---

## üöß –ü–û–†–Ø–î–û–ö –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

**–î–µ–Ω—å 1:**
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å MCP Server Wrapper (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)
2. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ Cursor

**–î–µ–Ω—å 2:**
3. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2)
4. ‚úÖ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è validate_entry

**–î–µ–Ω—å 3:**
5. ‚úÖ WebUI endpoint (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3, —á–∞—Å—Ç—å 1)
6. ‚úÖ React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

**–î–µ–Ω—å 4:**
7. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å TypeScript –æ—à–∏–±–∫–∏ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3, —á–∞—Å—Ç—å 2)
8. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å UI

**–î–µ–Ω—å 5:**
9. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4)
10. ‚úÖ CronJob setup

**–î–µ–Ω—å 6:**
11. ‚úÖ Unified Configuration (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 5)
12. ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 6, —á–∞—Å—Ç—å 1)

**–î–µ–Ω—å 7:**
13. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 6, —á–∞—Å—Ç—å 2)
14. ‚úÖ –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üìû –ü–û–î–î–ï–†–ñ–ö–ê

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏: `logs/autonomous_agent_server_*.log`
2. –ü—Ä–æ–≤–µ—Ä—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ `config_manager`
3. –ü—Ä–æ–≤–µ—Ä—å MCP server —Å—Ç–∞—Ç—É—Å –≤ Cursor
4. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

---

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 2025-01-20  
**–°—Ç–∞—Ç—É—Å:** READY FOR IMPLEMENTATION  
**–°–≤—è–∑–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç:** [AGENT_SYSTEM_RESEARCH.md](AGENT_SYSTEM_RESEARCH.md)