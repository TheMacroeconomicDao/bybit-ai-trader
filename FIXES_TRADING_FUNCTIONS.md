# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Trading Operations, Monitoring –∏ Auto-Actions

## üìã –û–±–∑–æ—Ä –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:
- **Trading Operations (4/4)**
- **Monitoring (2/2)**
- **Auto-Actions (2/2)**

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. `place_order` ‚úÖ
**–ü—Ä–æ–±–ª–µ–º–∞:** –£–∂–µ –±—ã–ª–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ä–∞–Ω–µ–µ, –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.

**–°—Ç–∞—Ç—É—Å:** –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 2. `close_position` ‚úÖ
**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –¥–ª—è spot
- –ù–µ —É—á–∏—Ç—ã–≤–∞–ª–∏—Å—å —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –∞–∫–∫–∞—É–Ω—Ç–æ–≤ (SPOT vs UNIFIED)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ —á–µ—Ä–µ–∑ SPOT, –∑–∞—Ç–µ–º —á–µ—Ä–µ–∑ UNIFIED
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ—Ç–≤–µ—Ç–∞ API
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –º–æ–Ω–µ—Ç—ã –≤ –∫–æ—à–µ–ª—å–∫–µ
- –î–æ–±–∞–≤–ª–µ–Ω `timeInForce: "IOC"` –¥–ª—è Market –æ—Ä–¥–µ—Ä–æ–≤

**–§–∞–π–ª:** `mcp_server/trading_operations.py` (—Å—Ç—Ä–æ–∫–∏ 227-307)

---

### 3. `modify_position` ‚úÖ
**–ü—Ä–æ–±–ª–µ–º—ã:**
- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `positionIdx` –¥–ª—è Bybit API
- –ù–µ –±—ã–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è –ø–æ–∑–∏—Ü–∏–∏ –ø–µ—Ä–µ–¥ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª—É—á–µ–Ω–∏–µ `positionIdx` –∏–∑ —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –æ—Ç–∫—Ä—ã—Ç–æ–π –ø–æ–∑–∏—Ü–∏–∏
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä (SL –∏–ª–∏ TP) —É–∫–∞–∑–∞–Ω
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

**–§–∞–π–ª:** `mcp_server/trading_operations.py` (—Å—Ç—Ä–æ–∫–∏ 349-428)

---

### 4. `cancel_order` ‚úÖ
**–ü—Ä–æ–±–ª–µ–º–∞:** –£–∂–µ –±—ã–ª–∞ —É–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–∞–Ω–µ–µ.

**–°—Ç–∞—Ç—É—Å:** –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 5. `start_position_monitoring` ‚úÖ
**–ü—Ä–æ–±–ª–µ–º—ã:**
- WebSocket callback –≤—ã–∑—ã–≤–∞–ª—Å—è –≤ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
- –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–æ–∑–¥–∞–Ω–∏–µ–º async tasks –∏–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ callback

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ async callbacks –≤ `_handle_position_update`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ event loop
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `_process_update_async`
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ tasks

**–§–∞–π–ª:** `mcp_server/position_monitor.py` (—Å—Ç—Ä–æ–∫–∏ 88-151)

---

### 6. `stop_position_monitoring` ‚úÖ
**–ü—Ä–æ–±–ª–µ–º—ã:**
- WebSocket –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–ª—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ù–µ –æ—á–∏—â–∞–ª–∏—Å—å –¥–∞–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–π

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –º–µ—Ç–æ–¥–æ–≤ `exit()` –∏ `close()` —É WebSocket
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ —Å–ª–æ–≤–∞—Ä—è –ø–æ–∑–∏—Ü–∏–π –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

**–§–∞–π–ª:** `mcp_server/position_monitor.py` (—Å—Ç—Ä–æ–∫–∏ 184-207)

---

### 7. `move_to_breakeven` ‚úÖ
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `modify_position`, –∫–æ—Ç–æ—Ä—ã–π —Ç–µ–ø–µ—Ä—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω.

**–°—Ç–∞—Ç—É—Å:** –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —á–µ—Ä–µ–∑ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π `modify_position`

---

### 8. `activate_trailing_stop` ‚úÖ
**–ü—Ä–æ–±–ª–µ–º—ã:**
- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `positionIdx`
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –ù–µ –±—ã–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ —á—Ç–æ trailing stop –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è futures

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ category –Ω–µ "spot" (trailing stop —Ç–æ–ª—å–∫–æ –¥–ª—è futures)
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª—É—á–µ–Ω–∏–µ `positionIdx` –∏–∑ —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω–µ –∏ —Å—Ç–æ—Ä–æ–Ω–µ –ø–æ–∑–∏—Ü–∏–∏ –≤ –æ—Ç–≤–µ—Ç–µ

**–§–∞–π–ª:** `mcp_server/trading_operations.py` (—Å—Ç—Ä–æ–∫–∏ 644-732)

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç: `test_trading_functions.py`

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:

```bash
cd /Users/Gyber/GYBERNATY-ECOSYSTEM/TRADER-AGENT
python test_trading_functions.py
```

### –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è:

1. ‚úÖ `place_order` - —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞
2. ‚úÖ `close_position` - –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ (spot –∏ futures)
3. ‚úÖ `modify_position` - –∏–∑–º–µ–Ω–µ–Ω–∏–µ SL/TP
4. ‚úÖ `cancel_order` - –æ—Ç–º–µ–Ω–∞ –æ—Ä–¥–µ—Ä–∞
5. ‚úÖ `start_position_monitoring` - –∑–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
6. ‚úÖ `stop_position_monitoring` - –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
7. ‚úÖ `move_to_breakeven` - –ø–µ—Ä–µ–≤–æ–¥ –≤ breakeven
8. ‚úÖ `activate_trailing_stop` - –∞–∫—Ç–∏–≤–∞—Ü–∏—è trailing stop

### –ü—Ä–∏–º–µ—á–∞–Ω–∏—è:

- –¢–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –∫–∞–∫ —É—Å–ø–µ—à–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏, —Ç–∞–∫ –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
- –ï—Å–ª–∏ –Ω–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π, —Ç–µ—Å—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç —ç—Ç–æ
- –¢–µ—Å—Ç—ã –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ —Ç–æ—Ä–≥–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–∫—Ä–æ–º–µ `place_order` —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Å—É–º–º–æ–π)

---

## üìù –î–µ—Ç–∞–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### `trading_operations.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- `close_position`: —É–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ spot –ø–æ–∑–∏—Ü–∏–π (—Å—Ç—Ä–æ–∫–∏ 227-307)
- `modify_position`: –¥–æ–±–∞–≤–ª–µ–Ω `positionIdx`, —É–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (—Å—Ç—Ä–æ–∫–∏ 349-428)
- `activate_trailing_stop`: –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ API (—Å—Ç—Ä–æ–∫–∏ 644-732)

### `position_monitor.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- `_handle_position_update`: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ async callbacks (—Å—Ç—Ä–æ–∫–∏ 88-145)
- `_process_update_async`: –Ω–æ–≤–∞—è –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è (—Å—Ç—Ä–æ–∫–∏ 147-151)
- `stop_monitoring`: —É–ª—É—á—à–µ–Ω–æ –∑–∞–∫—Ä—ã—Ç–∏–µ WebSocket –∏ –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö (—Å—Ç—Ä–æ–∫–∏ 184-207)

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ç–µ–ø–µ—Ä—å:
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã Bybit API
- ‚úÖ –ò–º–µ—é—Ç —É–ª—É—á—à–µ–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç spot –∏ futures —Ç–æ—Ä–≥–æ–≤–ª—é
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç —Å async –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
- ‚úÖ –ò–º–µ—é—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°—Ç–∞—Ç—É—Å:** –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ production! üöÄ













