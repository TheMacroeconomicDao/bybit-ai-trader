# üîß –ü–†–û–ú–ü–¢: –ö–û–ú–ü–õ–ï–ö–°–ù–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï –°–ò–°–¢–ï–ú–´ –¢–†–ï–ô–î–ò–ù–ì–ê

## –ö–û–ù–¢–ï–ö–°–¢

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –∏–∑ "—Å—Ç–∞—Ç–∏—á–Ω–æ–≥–æ –±–æ—Ç–∞ –¥–ª—è –Ω–æ–≤–∏—á–∫–∞" –≤ "–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ —Å –∏–Ω—Å—Ç–∏—Ç—É—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏". –≠—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–æ–≤ –∏ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –∞–Ω–∞–ª–∏–∑–∞.

## –ü–†–ò–û–†–ò–¢–ï–¢–´ –ò –ó–ê–î–ê–ß–ò

### üî¥ –§–ê–ó–ê 1: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø (Market Scanner)

**–§–∞–π–ª: `mcp_server/market_scanner.py`**

1.  **–£–¥–∞–ª–∏—Ç—å Hardcoded Values:**
    *   –ù–∞–π—Ç–∏ –∏ —É–¥–∞–ª–∏—Ç—å `ACCOUNT_BALANCE = 30.0`.
    *   –ù–∞–π—Ç–∏ –∏ —É–¥–∞–ª–∏—Ç—å `rr_score = 1.0`.

2.  **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Dynamic Logic:**
    *   –í `scan_market`: –ü–æ–ª—É—á–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å —á–µ—Ä–µ–∑ `self.client.get_wallet_balance`.
    *   –í `_generate_entry_plan`: –ü—Ä–∏–Ω–∏–º–∞—Ç—å `account_balance` –∫–∞–∫ –∞—Ä–≥—É–º–µ–Ω—Ç.
    *   –í `_calculate_opportunity_score`:
        *   –°–Ω–∞—á–∞–ª–∞ –≤—ã–∑—ã–≤–∞—Ç—å `_generate_entry_plan` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è SL/TP.
        *   –í—ã—á–∏—Å–ª—è—Ç—å `risk_reward = (take_profit - entry) / (entry - stop_loss)`.
        *   –ù–∞—á–∏—Å–ª—è—Ç—å –±–∞–ª–ª—ã: 1.0 –∑–∞ R:R > 2.5, 0.5 –∑–∞ R:R > 1.5, 0 –∏–Ω–∞—á–µ.

### üü† –§–ê–ó–ê 2: SMART MONEY –ò–ù–°–¢–†–£–ú–ï–ù–¢–´

**–§–∞–π–ª: `mcp_server/technical_analysis.py`**

1.  **–ú–µ—Ç–æ–¥ `get_cvd_divergence(symbol, limit=1000)`:**
    *   –ü–æ–ª—É—á–∞—Ç—å —Å–¥–µ–ª–∫–∏ —á–µ—Ä–µ–∑ `client.get_public_trade_history`.
    *   –°—á–∏—Ç–∞—Ç—å –∫—É–º—É–ª—è—Ç–∏–≤–Ω—É—é –¥–µ–ª—å—Ç—É –æ–±—ä–µ–º–æ–≤ (Buy - Sell).
    *   –°—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –Ω–∞–∫–ª–æ–Ω —Ü–µ–Ω—ã –∏ CVD –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N —Å–¥–µ–ª–æ–∫.
    *   –í–æ–∑–≤—Ä–∞—â–∞—Ç—å: `divergence` ("bullish", "bearish", "none").

2.  **–ú–µ—Ç–æ–¥ `find_order_blocks(df)`:**
    *   –ò—Å–∫–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω: –°–≤–µ—á–∞ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞ –ø–µ—Ä–µ–¥ —Å–∏–ª—å–Ω—ã–º –∏–º–ø—É–ª—å—Å–æ–º (BOS).
    *   –í–æ–∑–≤—Ä–∞—â–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∑–æ–Ω –ø–æ–¥–¥–µ—Ä–∂–∫–∏/—Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è.

**–§–∞–π–ª: `mcp_server/market_scanner.py`**

1.  **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `scan_market`:**
    *   –î–ª—è —Ç–æ–ø-5 –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –≤—ã–∑—ã–≤–∞—Ç—å `get_cvd_divergence` –∏ `find_order_blocks`.
    *   –î–æ–±–∞–≤–∏—Ç—å –±–æ–Ω—É—Å–Ω—ã–µ –±–∞–ª–ª—ã –≤ —Å–∫–æ—Ä–∏–Ω–≥:
        *   CVD Divergence –≤ —Å—Ç–æ—Ä–æ–Ω—É —Å–¥–µ–ª–∫–∏: +1.5 –±–∞–ª–ª–∞.
        *   –¶–µ–Ω–∞ –≤–Ω—É—Ç—Ä–∏ Order Block: +1.0 –±–∞–ª–ª.

### üü° –§–ê–ó–ê 3: –ü–†–û–î–í–ò–ù–£–¢–´–ô –†–ò–°–ö-–ú–ï–ù–ï–î–ñ–ú–ï–ù–¢

**–§–∞–π–ª: `mcp_server/market_scanner.py`**

1.  **–ú–µ—Ç–æ–¥ `calculate_volatility_target_size`:**
    *   –ê—Ä–≥—É–º–µ–Ω—Ç—ã: `equity`, `target_volatility` (default 0.4 = 40% –≥–æ–¥–æ–≤—ã—Ö), `asset_atr`.
    *   –§–æ—Ä–º—É–ª–∞: `position_usd = (equity * (target_vol / sqrt(365))) / (asset_atr_pct)`.
    *   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –º–µ—Ç–æ–¥ –≤ `_generate_entry_plan` –∫–∞–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É –∏–ª–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é.

### üü¢ –§–ê–ó–ê 4: –û–ë–ù–û–í–õ–ï–ù–ò–ï –ü–†–û–ú–ü–¢–û–í

**–§–∞–π–ª: `prompts/market_analysis_protocol_optimized.md`**

1.  **–î–æ–±–∞–≤–∏—Ç—å —à–∞–≥–∏ –∞–Ω–∞–ª–∏–∑–∞ Smart Money:**
    *   "–ü—Ä–æ–≤–µ—Ä—å CVD Divergence –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—Ö–æ–¥–∞".
    *   "–ü—Ä–æ–≤–µ—Ä—å –Ω–∞–ª–∏—á–∏–µ Order Blocks —Ä—è–¥–æ–º —Å —Ü–µ–Ω–æ–π".

**–§–∞–π–ª: `prompts/position_monitoring_protocol.md`**

1.  **–î–æ–±–∞–≤–∏—Ç—å "Call-to-Action":**
    *   –í —à–∞–±–ª–æ–Ω –æ—Ç–≤–µ—Ç–∞ –¥–æ–±–∞–≤–∏—Ç—å: "‚è∞ –ü–æ—Å—Ç–∞–≤—å —Ç–∞–π–º–µ—Ä –Ω–∞ [N] –º–∏–Ω—É—Ç. –°–ø—Ä–æ—Å–∏ –º–µ–Ω—è '–ö–∞–∫ –ø–æ–∑–∏—Ü–∏—è?', —á—Ç–æ–±—ã —è –ø—Ä–æ–≤–µ—Ä–∏–ª –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å."

**–§–∞–π–ª: `prompts/agent_core_instructions.md`**

1.  **–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å:**
    *   –£–±—Ä–∞—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å—Ç–∞—Ä—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã.
    *   –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ CVD –ø–µ—Ä–µ–¥ —Ñ–∏–Ω–∞–ª—å–Ω—ã–º —Ä–µ—à–µ–Ω–∏–µ–º.

## –ü–û–†–Ø–î–û–ö –ò–°–ü–û–õ–ù–ï–ù–ò–Ø

1.  **–ö–û–î:** –°–Ω–∞—á–∞–ª–∞ –ø—Ä–∞–≤–∫–∏ –≤ `market_scanner.py` (Bug fixes).
2.  **–ö–û–î:** –†–µ–∞–ª–∏–∑–∞—Ü–∏—è CVD –∏ OB –≤ `technical_analysis.py`.
3.  **–ö–û–î:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –≤ Scanner.
4.  **–ü–†–û–ú–ü–¢–´:** –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Markdown —Ñ–∞–π–ª–æ–≤.
